<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Through The Ages - TCG Pack Opener</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      overflow-x: hidden;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .card-flip {
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }
    .card-flip.flipped {
      transform: rotateY(180deg);
    }
    .card-face {
      backface-visibility: hidden;
      position: absolute;
      inset: 0;
    }
    .card-back {
      transform: rotateY(180deg);
    }
    .card-tooltip {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 12px;
      white-space: nowrap;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s;
      margin-bottom: 8px;
      z-index: 100;
    }
    .card-wrapper:hover .card-tooltip {
      opacity: 1;
    }
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      cursor: pointer;
      animation: fadeIn 0.2s;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .modal-image {
      max-width: 90vw;
      max-height: 90vh;
      border-radius: 12px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      animation: zoomIn 0.2s;
    }
    @keyframes zoomIn {
      from { transform: scale(0.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
  

/* ---- Holo / Foil visuals ---- */
@keyframes holoSpin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes holoShimmer {
  0% { opacity: 0.10; transform: translateX(-20%) skewX(-10deg); }
  50% { opacity: 0.25; transform: translateX(20%) skewX(-10deg); }
  100% { opacity: 0.10; transform: translateX(-20%) skewX(-10deg); }
}

.foil-glow {
  position: relative;
}

/* Holo overlay applies to the revealed face that shows the card art */
.foil-glow .card-face.card-back {
  position: relative;
  overflow: hidden;
}

.foil-glow .card-face.card-back img {
  position: relative;
  z-index: 1;
}

/* Static, slightly-opaque rainbow filter to make the card itself look holographic */
.foil-glow .card-face.card-back::before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background: linear-gradient(120deg,
    rgba(255, 0, 128, 0.20),
    rgba(0, 255, 255, 0.20),
    rgba(255, 255, 0, 0.18),
    rgba(255, 0, 128, 0.20)
  );
  opacity: 0.30;
  mix-blend-mode: screen;
  pointer-events: none;
  z-index: 2;
}

/* Subtle highlight to sell the holo effect without animation */
.foil-glow .card-face.card-back::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background: radial-gradient(circle at 30% 20%, rgba(255,255,255,0.18), rgba(255,255,255,0.0) 50%);
  opacity: 0.22;
  mix-blend-mode: overlay;
  pointer-events: none;
  z-index: 2;
}

.holo-badge {
  background: linear-gradient(90deg,
    rgba(255, 0, 128, 0.40),
    rgba(0, 255, 255, 0.40),
    rgba(255, 255, 0, 0.40)
  );
  box-shadow: 0 0 18px rgba(255,255,255,0.15);
  color: rgba(255,255,255,0.98);
  text-shadow: 0 1px 2px rgba(0,0,0,0.85);
}

.rainbow-text {
  background: linear-gradient(90deg, #ff3ea5, #2ee9ff, #ffe155, #ff3ea5);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  filter: drop-shadow(0 0 10px rgba(255,255,255,0.20));
}

.holo-button {
  background: linear-gradient(90deg, #ff3ea5, #2ee9ff, #ffe155, #ff3ea5);
  box-shadow: 0 0 18px rgba(255,255,255,0.18);
}
</style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;

    // Since this is on GitHub Pages, use relative paths to images in the same repo
    const GITHUB_BASE = '.';

    // All 391 cards
    const ALL_CARDS = [
      { id: "1", name: "A Big Stick", rarity: "common", file: "A Big Stick.png" },
      { id: "2", name: "A Chill on the Wind", rarity: "uncommon", file: "A Chill on the Wind.png" },
      { id: "3", name: "Adaptability", rarity: "common", file: "Adaptability.png" },
      { id: "4", name: "Adrias", rarity: "legendary", file: "Adrias.png" },
      { id: "5", name: "All Eyes On You", rarity: "common", file: "All Eyes On You.png" },
      { id: "6", name: "All In", rarity: "rare", file: "All In.png" },
      { id: "7", name: "Animal Experiments", rarity: "rare", file: "Animal Experiments.png" },
      { id: "8", name: "Ante Up", rarity: "common", file: "Ante Up.png" },
      { id: "9", name: "Arbeleatrier", rarity: "common", file: "Arbeleatrier.png" },
      { id: "10", name: "Archer Legion", rarity: "common", file: "Archer Legion.png" },
      { id: "11", name: "Archer's Greaves", rarity: "common", file: "Archer's Greaves.png" },
      { id: "12", name: "Armistice", rarity: "uncommon", file: "Armistice.png" },
      { id: "13", name: "Armor Fitter Herc", rarity: "common", file: "Armor Fitter Herc.png" },
      { id: "14", name: "Armored Elephants", rarity: "common", file: "Armored Elephants.png" },
      { id: "15", name: "Assassinate", rarity: "rare", file: "Assassinate.png" },
      { id: "16", name: "Attempt at Re-Creation", rarity: "rare", file: "Attempt at Re-Creation.png" },
      { id: "17", name: "Azure Guard", rarity: "common", file: "Azure Guard.png" },
      { id: "18", name: "Azure, Star Seeker", rarity: "rare", file: "Azure, Star Seeker.png" },
      { id: "19", name: "Azure's Assistant", rarity: "common", file: "Azure's Assistant.png" },
      { id: "20", name: "Azure's Backup", rarity: "common", file: "Azure's Backup.png" },
      { id: "21", name: "Azure's Feral Cats", rarity: "common", file: "Azure's Feral Cats.png" },
      { id: "22", name: "Azure's Razor, Opus Dei", rarity: "rare", file: "Azure's Razor, Opus Dei.png" },
      { id: "23", name: "Azure's Razor, Opus Dei X", rarity: "ultra x rare", file: "Azure's Razor, Opus Dei X.png" },
      { id: "24", name: "Azure's Stars Aligned", rarity: "rare", file: "Azure's Stars Aligned.png" },
      { id: "25", name: "Azure's Stars Aligned X", rarity: "ultra x rare", file: "Azure's Stars Aligned X.png" },
      { id: "26", name: "Banner of Death", rarity: "uncommon", file: "Banner of Death.png" },
      { id: "27", name: "Banner of Pride", rarity: "uncommon", file: "Banner of Pride.png" },
      { id: "28", name: "Banner of Unity", rarity: "rare", file: "Banner of Unity.png" },
      { id: "29", name: "Banner of War", rarity: "uncommon", file: "Banner of War.png" },
      { id: "30", name: "Barbaric Shout", rarity: "uncommon", file: "Barbaric Shout.png" },
      { id: "31", name: "Basterd of Blades", rarity: "common", file: "Basterd of Blades.png" },
      { id: "32", name: "Battle of Champions", rarity: "rare", file: "Battle of Champions.png" },
      { id: "33", name: "Battle Owl", rarity: "uncommon", file: "Battle Owl.png" },
      { id: "34", name: "Beard Tokens", rarity: "uncommon", file: "Beard Tokens.png" },
      { id: "35", name: "Beastly Leather Gown", rarity: "uncommon", file: "Beastly Leather Gown.png" },
      { id: "36", name: "Behind Enemy Lines", rarity: "common", file: "Behind Enemy Lines.png" },
      { id: "37", name: "Belt of the Bold", rarity: "common", file: "Belt of the Bold.png" },
      { id: "38", name: "Benne, Indric's Only Friend", rarity: "common", file: "Benne, Indric's Only Friend.png" },
      { id: "39", name: "Berserker Mushroom", rarity: "common", file: "Berserker Mushroom.png" },
      { id: "40", name: "Biting Bats", rarity: "common", file: "Biting Bats.png" },
      { id: "41", name: "Blacksmith's Daughter", rarity: "uncommon", file: "Blacksmith's Daughter.png" },
      { id: "42", name: "Blade of Beginnings", rarity: "legendary", file: "Blade of Beginnings.png" },
      { id: "43", name: "Blade Sharpener Ansil", rarity: "uncommon", file: "Blade Sharpener Ansil.png" },
      { id: "44", name: "Blade-Winged Eagles", rarity: "uncommon", file: "Blade-Winged Eagles.png" },
      { id: "45", name: "Blinded Jalio, the One Who Takes", rarity: "common", file: "Blinded Jalio, the One Who Takes.png" },
      { id: "46", name: "Blizzerd", rarity: "common", file: "Blizzerd.png" },
      { id: "47", name: "Bloodlust", rarity: "common", file: "Bloodlust.png" },
      { id: "48", name: "Bloodmorn", rarity: "uncommon", file: "Bloodmorn.png" },
      { id: "49", name: "Bloodthirsty Mice", rarity: "common", file: "Bloodthirsty Mice.png" },
      { id: "50", name: "Bloody Bear", rarity: "common", file: "Bloody Bear.png" },
      { id: "51", name: "Bloody Scream", rarity: "uncommon", file: "Bloody Scream.png" },
      { id: "52", name: "Bluff", rarity: "common", file: "Bluff.png" },
      { id: "53", name: "Bonfire", rarity: "rare", file: "Bonfire.png" },
      { id: "54", name: "Bookkeeper Terrin", rarity: "uncommon", file: "Bookkeeper Terrin.png" },
      { id: "55", name: "Bounty Collectors", rarity: "common", file: "Bounty Collectors.png" },
      { id: "56", name: "Breaker Captain", rarity: "common", file: "Breaker Captain.png" },
      { id: "57", name: "Breaker Guard", rarity: "common", file: "Breaker Guard.png" },
      { id: "58", name: "Breaker's Focus", rarity: "common", file: "Breaker's Focus.png" },
      { id: "59", name: "Brew of the Dawn", rarity: "uncommon", file: "Brew of the Dawn.png" },
      { id: "60", name: "Bribe the Guards", rarity: "common", file: "Bribe the Guards.png" },
      { id: "61", name: "Burn the Tents", rarity: "uncommon", file: "Burn the Tents.png" },
      { id: "62", name: "Burned Into Memory", rarity: "common", file: "Burned Into Memory.png" },
      { id: "63", name: "Burning Soul", rarity: "uncommon", file: "Burning Soul.png" },
      { id: "64", name: "Call of Beasts", rarity: "uncommon", file: "Call of Beasts.png" },
      { id: "65", name: "Called It", rarity: "uncommon", file: "Called It.png" },
      { id: "66", name: "Cascade of Darkness", rarity: "common", file: "Cascade of Darkness.png" },
      { id: "67", name: "Castle Walls", rarity: "uncommon", file: "Castle Walls.png" },
      { id: "68", name: "Cerberus", rarity: "legendary", file: "Cerberus.png" },
      { id: "69", name: "Chain of the Gravetender", rarity: "rare", file: "Chain of the Gravetender.png" },
      { id: "70", name: "Chainmail Hood", rarity: "uncommon", file: "Chainmail Hood.png" },
      { id: "71", name: "Chalice of God", rarity: "uncommon", file: "Chalice of God.png" },
      { id: "72", name: "Change of the Seasons", rarity: "common", file: "Change of the Seasons.png" },
      { id: "73", name: "Charge", rarity: "legendary", file: "Charge.png" },
      { id: "74", name: "Chivalry", rarity: "uncommon", file: "Chivalry.png" },
      { id: "75", name: "Cleric", rarity: "rare", file: "Cleric.png" },
      { id: "76", name: "Combusting Mushroom", rarity: "common", file: "Combusting Mushroom.png" },
      { id: "77", name: "Commander Hew's Helm of Command", rarity: "uncommon", file: "Commander Hew's Helm of Command.png" },
      { id: "78", name: "Commander's Decree", rarity: "uncommon", file: "Commander's Decree.png" },
      { id: "79", name: "Cooked in Armor", rarity: "uncommon", file: "Cooked in Armor.png" },
      { id: "80", name: "Counterintelligence", rarity: "uncommon", file: "Counterintelligence.png" },
      { id: "81", name: "Crowspies", rarity: "uncommon", file: "Crowspies.png" },
      { id: "82", name: "Cultists", rarity: "uncommon", file: "Cultists.png" },
      { id: "83", name: "De'vone Matria", rarity: "common", file: "De'vone Matria.png" },
      { id: "84", name: "Death Becomes", rarity: "uncommon", file: "Death Becomes.png" },
      { id: "85", name: "Death Enough", rarity: "uncommon", file: "Death Enough.png" },
      { id: "86", name: "Death Forgets", rarity: "uncommon", file: "Death Forgets.png" },
      { id: "87", name: "Death Forgives", rarity: "uncommon", file: "Death Forgives.png" },
      { id: "88", name: "Death Indeed", rarity: "uncommon", file: "Death Indeed.png" },
      { id: "89", name: "Death Mushroom", rarity: "common", file: "Death Mushroom.png" },
      { id: "90", name: "Death Remembers", rarity: "uncommon", file: "Death Remembers.png" },
      { id: "91", name: "Defel, The Rain", rarity: "uncommon", file: "Defel, The Rain.png" },
      { id: "92", name: "Demense", rarity: "uncommon", file: "Demense .png" },
      { id: "93", name: "Deranged Prisoners", rarity: "common", file: "Deranged Prisoners.png" },
      { id: "94", name: "Diorys Gianpetro", rarity: "rare", file: "Diorys Gianpetro.png" },
      { id: "95", name: "Directionless", rarity: "common", file: "Directionless.png" },
      { id: "96", name: "Dishonorable Discharge", rarity: "common", file: "Dishonorable Discharge.png" },
      { id: "97", name: "Distortion Curse", rarity: "uncommon", file: "Distortion Curse.png" },
      { id: "98", name: "Divination Scribe", rarity: "common", file: "Divination Scribe.png" },
      { id: "99", name: "Divine Intervention", rarity: "legendary", file: "Divine Intervention.png" },
      { id: "100", name: "Double Down", rarity: "rare", file: "Double Down.png" },
      { id: "101", name: "Double Up", rarity: "common", file: "Double Up.png" },
      { id: "102", name: "Draft the Recruits", rarity: "rare", file: "Draft the Recruits.png" },
      { id: "103", name: "Dragonslayer", rarity: "rare", file: "Dragonslayer.png" },
      { id: "104", name: "Draught", rarity: "common", file: "Draught.png" },
      { id: "105", name: "Droves of Wolves", rarity: "common", file: "Droves of Wolves.png" },
      { id: "106", name: "Duray, Pickpocket", rarity: "common", file: "Duray, Pickpocket.png" },
      { id: "107", name: "Eat Up", rarity: "common", file: "Eat Up.png" },
      { id: "108", name: "Embolden", rarity: "common", file: "Embolden.png" },
      { id: "109", name: "Endless Knives", rarity: "rare", file: "Endless Knives.png" },
      { id: "110", name: "Enough!", rarity: "common", file: "Enough!.png" },
      { id: "111", name: "Ethical Soldier", rarity: "uncommon", file: "Ethical Soldier.png" },
      { id: "112", name: "Expensive Armor", rarity: "common", file: "Expensive Armor.png" },
      { id: "113", name: "Exploding Rats", rarity: "common", file: "Exploding Rats.png" },
      { id: "114", name: "Extortion", rarity: "common", file: "Extortion.png" },
      { id: "115", name: "Eye of Pride", rarity: "common", file: "Eye of Pride.png" },
      { id: "116", name: "Failed Insurrection", rarity: "rare", file: "Failed Insurrection.png" },
      { id: "117", name: "Fattened Battle Cattle", rarity: "common", file: "Fattened Battle Cattle.png" },
      { id: "118", name: "Fatty Gunni", rarity: "common", file: "Fatty Gunni.png" },
      { id: "119", name: "Feral Cats", rarity: "common", file: "Feral Cats.png" },
      { id: "120", name: "Field of Blood", rarity: "common", file: "Field of Blood.png" },
      { id: "121", name: "Final Charge", rarity: "uncommon", file: "Final Charge.png" },
      { id: "122", name: "Fire Arrows", rarity: "common", file: "Fire Arrows.png" },
      { id: "123", name: "Fisherman Yimoti", rarity: "common", file: "Fisherman Yimoti.png" },
      { id: "124", name: "Fixed Result", rarity: "common", file: "Fixed Result.png" },
      { id: "125", name: "Flute Player's Anthem", rarity: "uncommon", file: "Flute Player's Anthem.png" },
      { id: "126", name: "Foggy Hills", rarity: "common", file: "Foggy Hills.png" },
      { id: "127", name: "Foggy Morning", rarity: "rare", file: "Foggy Morning.png" },
      { id: "128", name: "Forged Vambraces", rarity: "common", file: "Forged Vambraces.png" },
      { id: "129", name: "Forgotten By the Future", rarity: "uncommon", file: "Forgotten By the Future.png" },
      { id: "130", name: "Fresh Drinking Water", rarity: "rare", file: "Fresh Drinking Water.png" },
      { id: "131", name: "Full Belly Ceddir", rarity: "common", file: "Full Belly Ceddir.png" },
      { id: "132", name: "General Azure", rarity: "rare", file: "General Azure.png" },
      { id: "133", name: "General's Bounty", rarity: "uncommon", file: "General's Bounty.png" },
      { id: "134", name: "General's Command", rarity: "common", file: "General's Command.png" },
      { id: "135", name: "Getaway Steeds", rarity: "uncommon", file: "Getaway Steeds.png" },
      { id: "136", name: "Give Ground", rarity: "common", file: "Give Ground.png" },
      { id: "137", name: "Golden Knight Captain", rarity: "uncommon", file: "Golden Knight Captain.png" },
      { id: "138", name: "Golden Knight Leader Lorren", rarity: "uncommon", file: "Golden Knight Leader Lorren.png" },
      { id: "139", name: "Golden Ymra", rarity: "rare", file: "Golden Ymra.png" },
      { id: "140", name: "Golden Ymra X", rarity: "ultra x rare", file: "Golden Ymra X.png" },
      { id: "141", name: "Grand Researcher Udolvis", rarity: "uncommon", file: "Grand Researcher Udolvis.png" },
      { id: "142", name: "Grandfather Pine", rarity: "uncommon", file: "Grandfather Pine.png" },
      { id: "143", name: "Gravetender's Shovel", rarity: "uncommon", file: "Gravetender's Shovel.png" },
      { id: "144", name: "Greatwall Yvera", rarity: "uncommon", file: "Greatwall Yvera.png" },
      { id: "145", name: "Greselia, Worldhopper", rarity: "uncommon", file: "Greselia, Worldhopper.png" },
      { id: "146", name: "Grew Up Together", rarity: "common", file: "Grew Up Together.png" },
      { id: "147", name: "Group of Corrupts", rarity: "common", file: "Group of Corrupts.png" },
      { id: "148", name: "Grozu", rarity: "common", file: "Grozu.png" },
      { id: "149", name: "Guttermite Drinny", rarity: "common", file: "Guttermite Drinny.png" },
      { id: "150", name: "Handwraps", rarity: "common", file: "Handwraps.png" },
      { id: "151", name: "Helm of Time", rarity: "rare", file: "Helm of Time.png" },
      { id: "152", name: "Hide", rarity: "uncommon", file: "Hide.png" },
      { id: "153", name: "High Morale", rarity: "rare", file: "High Morale.png" },
      { id: "154", name: "Honorable Discharge", rarity: "common", file: "Honorable Discharge.png" },
      { id: "155", name: "Hornman Thut", rarity: "common", file: "Hornman Thut.png" },
      { id: "156", name: "Houndmaster Bretta", rarity: "rare", file: "Houndmaster Bretta.png" },
      { id: "157", name: "Human Test Subject", rarity: "uncommon", file: "Human Test Subject.png" },
      { id: "158", name: "Hungover Golden Knights", rarity: "common", file: "Hungover Golden Knights.png" },
      { id: "159", name: "Huntsman Brekka", rarity: "common", file: "Huntsman Brekka.png" },
      { id: "160", name: "Hurd and Grozu", rarity: "common", file: "Hurd and Grozu.png" },
      { id: "161", name: "Ignorant Foresh", rarity: "common", file: "Ignorant Foresh.png" },
      { id: "162", name: "In the Shade of the Trees", rarity: "rare", file: "In the Shade of the Trees.png" },
      { id: "163", name: "Indric Puratta, the World is His", rarity: "rare", file: "Indric Puratta, the World is His.png" },
      { id: "164", name: "Indric Puratta, The World Is His X", rarity: "ultra x rare", file: "Indric Puratta, The World Is His X.png" },
      { id: "165", name: "Injection of Funds", rarity: "uncommon", file: "Injection of Funds.png" },
      { id: "166", name: "Intersection of Past and Future", rarity: "common", file: "Intersection of Past and Future.png" },
      { id: "167", name: "Intimidation", rarity: "rare", file: "Intimidation.png" },
      { id: "168", name: "Jacques", rarity: "rare", file: "Jacques.png" },
      { id: "169", name: "Jailbreak", rarity: "common", file: "Jailbreak.png" },
      { id: "170", name: "Journey to the Otherside", rarity: "common", file: "Journey to the Otherside.png" },
      { id: "171", name: "Keep the Family Close", rarity: "rare", file: "Keep the Family Close.png" },
      { id: "172", name: "King's Favor", rarity: "uncommon", file: "King's Favor.png" },
      { id: "173", name: "Kingkiller Vodd", rarity: "rare", file: "Kingkiller Vodd.png" },
      { id: "174", name: "Knife Maiden", rarity: "common", file: "Knife Maiden.png" },
      { id: "175", name: "Landshark", rarity: "common", file: "Landshark.png" },
      { id: "176", name: "Latrine Diggers", rarity: "common", file: "Latrine Diggers.png" },
      { id: "177", name: "Lead Astray", rarity: "uncommon", file: "Lead Astray.png" },
      { id: "178", name: "Leader of the Maggots", rarity: "common", file: "Leader of the Maggots.png" },
      { id: "179", name: "Leather Coat", rarity: "uncommon", file: "Leather Coat.png" },
      { id: "180", name: "Lectio Divinia", rarity: "legendary", file: "Lectio Divinia.png" },
      { id: "181", name: "Letters to the Future", rarity: "rare", file: "Letters to the Future.png" },
      { id: "182", name: "Lost Company", rarity: "common", file: "Lost Company.png" },
      { id: "183", name: "Loyal Hounds", rarity: "common", file: "Loyal Hounds.png" },
      { id: "184", name: "Lupin, Young Royal", rarity: "common", file: "Lupin, Young Royal.png" },
      { id: "185", name: "Marching On", rarity: "common", file: "Marching On.png" },
      { id: "186", name: "Marshland", rarity: "common", file: "Marshland.png" },
      { id: "187", name: "Master Assassin", rarity: "uncommon", file: "Master Assassin.png" },
      { id: "188", name: "Midnight Concoction", rarity: "uncommon", file: "Midnight Concoction.png" },
      { id: "189", name: "Mink, Jester of Kings", rarity: "uncommon", file: "Mink, Jester of Kings.png" },
      { id: "190", name: "Misplaced Treasure", rarity: "rare", file: "Misplaced Treasure.png" },
      { id: "191", name: "Moldy Bread", rarity: "common", file: "Moldy Bread.png" },
      { id: "192", name: "More Than Enough", rarity: "uncommon", file: "More Than Enough.png" },
      { id: "193", name: "Mouth of Hate", rarity: "uncommon", file: "Mouth of Hate.png" },
      { id: "194", name: "Mundane Murderer", rarity: "common", file: "Mundane Murderer.png" },
      { id: "195", name: "Mushroom Feaster", rarity: "common", file: "Mushroom Feaster.png" },
      { id: "196", name: "Necrokane", rarity: "common", file: "Necrokane.png" },
      { id: "197", name: "Nightfall", rarity: "legendary", file: "Nightfall.png" },
      { id: "198", name: "Nightretch Assassins", rarity: "uncommon", file: "Nightretch Assassins.png" },
      { id: "199", name: "No Soldier Goes Unpaid", rarity: "uncommon", file: "No Soldier Goes Unpaid.png" },
      { id: "200", name: "Not Enough to Drink", rarity: "common", file: "Not Enough to Drink.png" },
      { id: "201", name: "Not So Well Thought Plan", rarity: "common", file: "Not So Well Thought Plan.png" },
      { id: "202", name: "Not Today, Soldier!", rarity: "uncommon", file: "Not Today, Soldier!.png" },
      { id: "203", name: "Nothing Left", rarity: "rare", file: "Nothing Left.png" },
      { id: "204", name: "Old Man Sigra", rarity: "uncommon", file: "Old Man Sigra.png" },
      { id: "205", name: "Oracle", rarity: "uncommon", file: "Oracle.png" },
      { id: "206", name: "Overworked Bookkeeper", rarity: "common", file: "Overworked Bookkeeper.png" },
      { id: "207", name: "Pack of Hounds", rarity: "common", file: "Pack of Hounds.png" },
      { id: "208", name: "Page Idica", rarity: "uncommon", file: "Page Idica.png" },
      { id: "209", name: "Page of Hands", rarity: "uncommon", file: "Page of Hands.png" },
      { id: "210", name: "Page Yus", rarity: "uncommon", file: "Page Yus.png" },
      { id: "211", name: "Paid Off", rarity: "common", file: "Paid Off.png" },
      { id: "212", name: "Parade", rarity: "common", file: "Parade.png" },
      { id: "213", name: "Parley", rarity: "common", file: "Parley.png" },
      { id: "214", name: "Pay Up", rarity: "common", file: "Pay Up.png" },
      { id: "215", name: "Penny Pincher", rarity: "uncommon", file: "Penny Pincher.png" },
      { id: "216", name: "Pickpocket", rarity: "common", file: "Pickpocket.png" },
      { id: "217", name: "Place the Order", rarity: "common", file: "Place the Order.png" },
      { id: "218", name: "Plague of Rats", rarity: "common", file: "Plague of Rats.png" },
      { id: "219", name: "Plan", rarity: "common", file: "Plan.png" },
      { id: "220", name: "Plate of Night", rarity: "uncommon", file: "Plate of Night.png" },
      { id: "221", name: "Porous Ducts", rarity: "common", file: "Porous Ducts.png" },
      { id: "222", name: "Prayer", rarity: "common", file: "Prayer.png" },
      { id: "223", name: "Prayer of Winds", rarity: "uncommon", file: "Prayer of Winds.png" },
      { id: "224", name: "Premeditated", rarity: "uncommon", file: "Premeditated.png" },
      { id: "225", name: "Prepare to Strike", rarity: "uncommon", file: "Prepare to Strike.png" },
      { id: "226", name: "Promising Recruit", rarity: "common", file: "Promising Recruit.png" },
      { id: "227", name: "Prophecy", rarity: "common", file: "Prophecy.png" },
      { id: "228", name: "Protectorate Genus", rarity: "common", file: "Protectorate Genus.png" },
      { id: "229", name: "Protectorate Leader of All", rarity: "uncommon", file: "Protectorate Leader of All.png" },
      { id: "230", name: "Proud Soldiers", rarity: "common", file: "Proud Soldiers.png" },
      { id: "231", name: "Puratta's Broadsword, Blessed Blade", rarity: "rare", file: "Puratta's Broadsword, Blessed Blade.png" },
      { id: "232", name: "Puratta's Broadsword, Blessed Blade X", rarity: "ultra x rare", file: "Puratta's Broadsword, Blessed Blade X.png" },
      { id: "233", name: "Puratta's Oath", rarity: "common", file: "Puratta's Oath.png" },
      { id: "234", name: "Putyr, Viero, and Shara Vallobranch", rarity: "rare", file: "Putyr, Viero, and Shara Vallobranch.png" },
      { id: "235", name: "Putyr's Favorite Charger", rarity: "common", file: "Putyr's Favorite Charger.png" },
      { id: "236", name: "Quake", rarity: "legendary", file: "Quake.png" },
      { id: "237", name: "Quartermaster Bergana", rarity: "rare", file: "Quartermaster Bergana.png" },
      { id: "238", name: "Queens Command", rarity: "uncommon", file: "Queens Command.png" },
      { id: "239", name: "Quick Grab", rarity: "uncommon", file: "Quick Grab.png" },
      { id: "240", name: "Rampaging Demigod Vodd", rarity: "rare", file: "Rampaging Demigod Vodd.png" },
      { id: "241", name: "Rampaging Demigod Vodd X", rarity: "ultra x rare", file: "Rampaging Demigod Vodd X.png" },
      { id: "242", name: "Ready Or Not", rarity: "uncommon", file: "Ready Or Not.png" },
      { id: "243", name: "Reborn Rabbit", rarity: "common", file: "Reborn Rabbit.png" },
      { id: "244", name: "Recco", rarity: "rare", file: "Recco.png" },
      { id: "245", name: "Recco Demonblood", rarity: "rare", file: "Recco Demonblood.png" },
      { id: "246", name: "Recco, Plane of Hate", rarity: "legendary", file: "Recco, Plane of Hate.png" },
      { id: "247", name: "Regroup", rarity: "common", file: "Regroup.png" },
      { id: "248", name: "Researcher Pilio", rarity: "common", file: "Researcher Pilio.png" },
      { id: "249", name: "Researcher Recruit", rarity: "common", file: "Researcher Recruit.png" },
      { id: "250", name: "Retreat", rarity: "common", file: "Retreat.png" },
      { id: "251", name: "Rew, the Butcher", rarity: "uncommon", file: "Rew, the Butcher.png" },
      { id: "252", name: "Ritual Maiden Ferlindie", rarity: "uncommon", file: "Ritual Maiden Ferlindie.png" },
      { id: "253", name: "Roques", rarity: "legendary", file: "Roques.png" },
      { id: "254", name: "Royal Palace", rarity: "common", file: "Royal Palace.png" },
      { id: "255", name: "Rupert, Flag Bearer", rarity: "uncommon", file: "Rupert, Flag Bearer.png" },
      { id: "256", name: "Rusty Sword", rarity: "common", file: "Rusty Sword.png" },
      { id: "257", name: "Sacrificial Boars", rarity: "uncommon", file: "Sacrificial Boars.png" },
      { id: "258", name: "Sadistic Wretch", rarity: "common", file: "Sadistic Wretch.png" },
      { id: "259", name: "Salla Salvato, Disguise Master", rarity: "common", file: "Salla Salvato, Disguise Master.png" },
      { id: "260", name: "Salutaions", rarity: "common", file: "Salutaions.png" },
      { id: "261", name: "Scars of a General's Past", rarity: "rare", file: "Scars of a General's Past.png" },
      { id: "262", name: "See it in the Bones", rarity: "common", file: "See it in the Bones.png" },
      { id: "263", name: "Send in the Ladies", rarity: "uncommon", file: "Send in the Ladies.png" },
      { id: "264", name: "Ser Banyon", rarity: "common", file: "Ser Banyon.png" },
      { id: "265", name: "Ser Geren, Knight of the King", rarity: "uncommon", file: "Ser Geren, Knight of the King.png" },
      { id: "266", name: "Ser Indric", rarity: "rare", file: "Ser Indric.png" },
      { id: "267", name: "Ser Indric's Victory", rarity: "rare", file: "Ser Indric's Victory.png" },
      { id: "268", name: "Sewers", rarity: "common", file: "Sewers.png" },
      { id: "269", name: "Shamed Royal", rarity: "common", file: "Shamed Royal.png" },
      { id: "270", name: "Shara, The Lone Branch", rarity: "rare", file: "Shara, The Lone Branch.png" },
      { id: "271", name: "Shara, The Lone Branch X", rarity: "ultra x rare", file: "Shara, The Lone Branch X.png" },
      { id: "272", name: "Sharpened Blade", rarity: "uncommon", file: "Sharpened Blade.png" },
      { id: "273", name: "Siege Weapons", rarity: "rare", file: "Siege Weapons.png" },
      { id: "274", name: "Sister Wressa", rarity: "common", file: "Sister Wressa.png" },
      { id: "275", name: "Sister Wrinna", rarity: "common", file: "Sister Wrinna.png" },
      { id: "276", name: "Sleep Mushroom", rarity: "common", file: "Sleep Mushroom.png" },
      { id: "277", name: "Slingshot", rarity: "common", file: "Slingshot.png" },
      { id: "278", name: "Snake Under the Sheets", rarity: "common", file: "Snake Under the Sheets.png" },
      { id: "279", name: "Snakeskin Assassin", rarity: "uncommon", file: "Snakeskin Assassin.png" },
      { id: "280", name: "Son of Arvada, Personal Guard", rarity: "common", file: "Son of Arvada, Personal Guard.png" },
      { id: "281", name: "Soulcloud", rarity: "common", file: "Soulcloud.png" },
      { id: "282", name: "Speak with Animals", rarity: "common", file: "Speak with Animals.png" },
      { id: "283", name: "Split Open", rarity: "common", file: "Split Open.png" },
      { id: "284", name: "Spotter", rarity: "common", file: "Spotter.png" },
      { id: "285", name: "Sprout Horns", rarity: "common", file: "Sprout Horns.png" },
      { id: "286", name: "Spyglass", rarity: "uncommon", file: "Spyglass.png" },
      { id: "287", name: "Spymaster Droxy", rarity: "rare", file: "Spymaster Droxy.png" },
      { id: "288", name: "Squire Moveux", rarity: "common", file: "Squire Moveux.png" },
      { id: "289", name: "Staff of the Beast", rarity: "common", file: "Staff of the Beast.png" },
      { id: "290", name: "Starlight", rarity: "legendary", file: "Starlight.png" },
      { id: "291", name: "Stash House", rarity: "common", file: "Stash House.png" },
      { id: "292", name: "Steady!", rarity: "common", file: "Steady!.png" },
      { id: "293", name: "Stigmata", rarity: "uncommon", file: "Stigmata.png" },
      { id: "294", name: "Stone Mushroom", rarity: "common", file: "Stone Mushroom.png" },
      { id: "295", name: "Stored for Later", rarity: "common", file: "Stored for Later.png" },
      { id: "296", name: "Sturdy Leather Boots", rarity: "common", file: "Sturdy Leather Boots.png" },
      { id: "297", name: "Sturdy Phalanx", rarity: "uncommon", file: "Sturdy Phalanx.png" },
      { id: "298", name: "Summoner Aslye", rarity: "uncommon", file: "Summoner Aslye.png" },
      { id: "299", name: "Sunrise", rarity: "legendary", file: "Sunrise.png" },
      { id: "300", name: "Sunset", rarity: "common", file: "Sunset.png" },
      { id: "301", name: "Supplies", rarity: "common", file: "Supplies.png" },
      { id: "302", name: "Supply Line Cutoff", rarity: "uncommon", file: "Supply Line Cutoff.png" },
      { id: "303", name: "Sweat", rarity: "common", file: "Sweat.png" },
      { id: "304", name: "Tales of Yternus", rarity: "uncommon", file: "Tales of Yternus.png" },
      { id: "305", name: "Tears of God", rarity: "legendary", file: "Tears of God.png" },
      { id: "306", name: "Temporary Encampment", rarity: "rare", file: "Temporary Encampment.png" },
      { id: "307", name: "Tempted Traitor", rarity: "uncommon", file: "Tempted Traitor.png" },
      { id: "308", name: "Tent Maiden", rarity: "common", file: "Tent Maiden.png" },
      { id: "309", name: "Teserio the Mage", rarity: "common", file: "Teserio the Mage.png" },
      { id: "310", name: "The Bonfire", rarity: "common", file: "The Bonfire.png" },
      { id: "311", name: "The Burning Pile", rarity: "common", file: "The Burning Pile.png" },
      { id: "312", name: "The Castle", rarity: "common", file: "The Castle.png" },
      { id: "313", name: "The Core", rarity: "rare", file: "The Core.png" },
      { id: "314", name: "The Creator's Star", rarity: "rare", file: "The Creator's Star.png" },
      { id: "315", name: "The Fixer", rarity: "uncommon", file: "The Fixer.png" },
      { id: "316", name: "The Forgotten Branch", rarity: "rare", file: "The Forgotten Branch.png" },
      { id: "317", name: "The Funeral", rarity: "rare", file: "The Funeral.png" },
      { id: "318", name: "The House", rarity: "rare", file: "The House.png" },
      { id: "319", name: "The House Always Wins", rarity: "common", file: "The House Always Wins.png" },
      { id: "320", name: "The Influence", rarity: "rare", file: "The Influence.png" },
      { id: "321", name: "The Knights Creed", rarity: "common", file: "The Knights Creed.png" },
      { id: "322", name: "The Laughing Knight", rarity: "common", file: "The Laughing Knight.png" },
      { id: "323", name: "The Lie", rarity: "rare", file: "The Lie.png" },
      { id: "324", name: "The Negotiator", rarity: "uncommon", file: "The Negotiator.png" },
      { id: "325", name: "The Night Before", rarity: "uncommon", file: "The Night Before.png" },
      { id: "326", name: "The Pact", rarity: "rare", file: "The Pact.png" },
      { id: "327", name: "The People's Knight", rarity: "rare", file: "The People's Knight.png" },
      { id: "328", name: "The Perfect Moment", rarity: "common", file: "The Perfect Moment.png" },
      { id: "329", name: "The Reborn", rarity: "common", file: "The Reborn.png" },
      { id: "330", name: "The Ritual", rarity: "rare", file: "The Ritual.png" },
      { id: "331", name: "The Sleepless Man", rarity: "uncommon", file: "The Sleepless Man.png" },
      { id: "332", name: "The Timer", rarity: "uncommon", file: "The Timer.png" },
      { id: "333", name: "The Vallobranch Family Blade", rarity: "rare", file: "The Vallobranch Family Blade.png" },
      { id: "334", name: "The Vallobranch Family Blade X", rarity: "ultra x rare", file: "The Vallobranch Family Blade X.png" },
      { id: "335", name: "Thunderstorm", rarity: "common", file: "Thunderstorm.png" },
      { id: "336", name: "Too Much to Drink", rarity: "uncommon", file: "Too Much to Drink.png" },
      { id: "337", name: "Trained Hawk", rarity: "common", file: "Trained Hawk.png" },
      { id: "338", name: "Trash Panda", rarity: "common", file: "Trash Panda.png" },
      { id: "339", name: "Traveling Merchant", rarity: "uncommon", file: "Traveling Merchant.png" },
      { id: "340", name: "Trebuchet Tactics", rarity: "rare", file: "Trebuchet Tactics.png" },
      { id: "341", name: "Tremors", rarity: "uncommon", file: "Tremors.png" },
      { id: "342", name: "Trench Diggers", rarity: "common", file: "Trench Diggers.png" },
      { id: "343", name: "Turn the Other Way", rarity: "common", file: "Turn the Other Way.png" },
      { id: "344", name: "Unchained Tiger", rarity: "uncommon", file: "Unchained Tiger.png" },
      { id: "345", name: "Uncontrollable Bloom", rarity: "legendary", file: "Uncontrollable Bloom.png" },
      { id: "346", name: "Under the Stars", rarity: "common", file: "Under the Stars.png" },
      { id: "347", name: "Unnamed Slaves", rarity: "common", file: "Unnamed Slaves.png" },
      { id: "348", name: "Unseen Forces", rarity: "rare", file: "Unseen Forces.png" },
      { id: "349", name: "Unseen Terror-Monger", rarity: "common", file: "Unseen Terror-Monger.png" },
      { id: "350", name: "Used Chainmail", rarity: "uncommon", file: "Used Chainmail.png" },
      { id: "351", name: "Utility Belt", rarity: "common", file: "Utility Belt.png" },
      { id: "352", name: "Vallobranch Riches", rarity: "uncommon", file: "Vallobranch Riches.png" },
      { id: "353", name: "Valuable Prisoner", rarity: "rare", file: "Valuable Prisoner.png" },
      { id: "354", name: "Veiled Guard of Stars", rarity: "common", file: "Veiled Guard of Stars.png" },
      { id: "355", name: "Vesta's Roar", rarity: "rare", file: "Vesta's Roar.png" },
      { id: "356", name: "Victorious!", rarity: "common", file: "Victorious!.png" },
      { id: "357", name: "Viero and Shara", rarity: "rare", file: "Viero and Shara.png" },
      { id: "358", name: "Viero's Family Ring", rarity: "rare", file: "Viero's Family Ring.png" },
      { id: "359", name: "Violetta Shadowhunt", rarity: "rare", file: "Violetta Shadowhunt.png" },
      { id: "360", name: "Violetta Shadowhunt X", rarity: "ultra x rare", file: "Violetta Shadowhunt X.png" },
      { id: "361", name: "Violetta, First Meeting", rarity: "rare", file: "Violetta, First Meeting.png" },
      { id: "362", name: "Violetta's Gamble", rarity: "rare", file: "Violetta's Gamble.png" },
      { id: "363", name: "Violetta's Mistakes", rarity: "rare", file: "Violetta's Mistakes.png" },
      { id: "364", name: "Violetta's Straight Sword, Oathtaker", rarity: "rare", file: "Violetta's Straight Sword, Oathtaker.png" },
      { id: "365", name: "Violetta's Straight Sword, Oathtaker X", rarity: "ultra x rare", file: "Violetta's Straight Sword, Oathtaker X.png" },
      { id: "366", name: "Visions", rarity: "uncommon", file: "Visions.png" },
      { id: "367", name: "Vodd, Tamed", rarity: "rare", file: "Vodd, Tamed.png" },
      { id: "368", name: "Vodd's Champion", rarity: "uncommon", file: "Vodd's Champion.png" },
      { id: "369", name: "Vodd's Dual Swords, Tyrant and Tamer", rarity: "rare", file: "Vodd's Dual Swords, Tyrant and Tamer.png" },
      { id: "370", name: "Vodd's Dual Swords, Tyrant and Tamer X", rarity: "ultra x rare", file: "Vodd's Dual Swords, Tyrant and Tamer X.png" },
      { id: "371", name: "Vodd's Duststorm", rarity: "uncommon", file: "Vodd's Duststorm.png" },
      { id: "372", name: "Vodd's Visions", rarity: "rare", file: "Vodd's Visions.png" },
      { id: "373", name: "Wannabe Killer", rarity: "common", file: "Wannabe Killer.png" },
      { id: "374", name: "War Horse", rarity: "common", file: "War Horse.png" },
      { id: "375", name: "Washed Clean", rarity: "common", file: "Washed Clean.png" },
      { id: "376", name: "Wasted Talent", rarity: "common", file: "Wasted Talent.png" },
      { id: "377", name: "Weary Traveller", rarity: "common", file: "Weary Traveller.png" },
      { id: "378", name: "Well Thought Plan", rarity: "uncommon", file: "Well Thought Plan.png" },
      { id: "379", name: "What the Future Holds", rarity: "rare", file: "What the Future Holds.png" },
      { id: "380", name: "Wide Swing", rarity: "uncommon", file: "Wide Swing.png" },
      { id: "381", name: "Wild Visionary", rarity: "common", file: "Wild Visionary.png" },
      { id: "382", name: "Words, Soft Spoken", rarity: "uncommon", file: "Words, Soft Spoken.png" },
      { id: "383", name: "Ymra, Barbarica", rarity: "rare", file: "Ymra, Barbarica.png" },
      { id: "384", name: "Ymra, Covered In Blood", rarity: "rare", file: "Ymra, Covered In Blood.png" },
      { id: "385", name: "Ymra's Axe of the Sun", rarity: "rare", file: "Ymra's Axe of the Sun.png" },
      { id: "386", name: "Ymra's Axe of the Sun X", rarity: "ultra x rare", file: "Ymra's Axe of the Sun X.png" },
      { id: "387", name: "Ymra's Chosen Sacrifice", rarity: "uncommon", file: "Ymra's Chosen Sacrifice.png" },
      { id: "388", name: "Ymra's Prayers", rarity: "uncommon", file: "Ymra's Prayers.png" },
      { id: "389", name: "Ymra's Wolves", rarity: "uncommon", file: "Ymra's Wolves.png" },
      { id: "390", name: "Young Fil", rarity: "common", file: "Young Fil.png" },
      { id: "391", name: "Yun-Wa, Advisor", rarity: "common", file: "Yun-Wa, Advisor.png" }
    ];

    const getImageUrl = (card) => {
      const folder = card.rarity.replace(/ /g, '%20');
      const filename = card.file.replace(/ /g, '%20');
      return `${GITHUB_BASE}/${folder}/${filename}`;
    };

    const CARDS_BY_RARITY = {
      common: ALL_CARDS.filter(c => c.rarity === 'common'),
      uncommon: ALL_CARDS.filter(c => c.rarity === 'uncommon'),
      rare: ALL_CARDS.filter(c => c.rarity === 'rare'),
      legendary: ALL_CARDS.filter(c => c.rarity === 'legendary'),
      'ultra x rare': ALL_CARDS.filter(c => c.rarity === 'ultra x rare')
    };

    const RARITY_COLORS = {
      common: { bg: '#4b5563', border: '#9ca3af', text: '#d1d5db' },
      uncommon: { bg: '#15803d', border: '#4ade80', text: '#86efac' },
      rare: { bg: '#1d4ed8', border: '#60a5fa', text: '#93c5fd' },
      legendary: { bg: '#7e22ce', border: '#a855f7', text: '#c4b5fd' },
      'ultra x rare': { bg: '#dc2626', border: '#fbbf24', text: '#fef08a' }
    };

    const RARITY_ORDER = ['common', 'uncommon', 'rare', 'legendary', 'ultra x rare'];

    function TCGPackOpener() {
      const [collection, setCollection] = useState({});
      const [packCards, setPackCards] = useState([]);
      const [revealedCards, setRevealedCards] = useState([]);
      const [view, setView] = useState('home');
      const [allRevealed, setAllRevealed] = useState(false);
      const [collectionFilter, setCollectionFilter] = useState('all');
      const [collectionSearch, setCollectionSearch] = useState('');
      const [ownedFilter, setOwnedFilter] = useState('all'); // all | owned | unowned
      const [holoFilter, setHoloFilter] = useState('all');   // all | hasHolo | noHolo
      const [sortKey, setSortKey] = useState('owned');       // owned | name | rarity | value | holoValue | change | holoMult
      const [sortDir, setSortDir] = useState('desc');        // asc | desc
      const [hideUnknown, setHideUnknown] = useState(false);
      const [packCount, setPackCount] = useState(0);
      const [isLoaded, setIsLoaded] = useState(false);
      const [enlargedCard, setEnlargedCard] = useState(null);
      const [rations, setRations] = useState(0);
      const [marketValues, setMarketValues] = useState({});
      const [priceHistory, setPriceHistory] = useState({});
      const [sellConfirm, setSellConfirm] = useState(null);
      const [packInventory, setPackInventory] = useState([]);

      const [purchaseConfirm, setPurchaseConfirm] = useState(null);
      const [holoMultipliers, setHoloMultipliers] = useState({});

      // Generate weighted random value within range (bell curve distribution)
      const generateWeightedValue = (min, max, peak) => {
        // Use 3 random numbers averaged for bell curve effect
        const r1 = Math.random();
        const r2 = Math.random();
        const r3 = Math.random();
        const avg = (r1 + r2 + r3) / 3;
        
        // Weight towards peak
        const range = max - min;
        const peakOffset = peak - min;
        const peakRatio = peakOffset / range;
        
        // Adjust distribution to favor peak
        let value;
        if (avg < 0.5) {
          value = min + (avg * 2 * peakOffset);
        } else {
          value = peak + ((avg - 0.5) * 2 * (max - peak));
        }
        
        return parseFloat(value.toFixed(2));
      };

      // Generate initial market values for all cards
      const generateMarketValues = () => {
        const values = {};
        ALL_CARDS.forEach(card => {
          let value;
          switch(card.rarity) {
            case 'common':
              value = generateWeightedValue(0.5, 5.5, 1.0);
              break;
            case 'uncommon':
              value = generateWeightedValue(1.5, 8.0, 3.0);
              break;
            case 'rare':
              value = generateWeightedValue(3.5, 25.0, 5.0);
              break;
            case 'legendary':
              value = generateWeightedValue(9.25, 87.0, 20.0);
              break;
            case 'ultra x rare':
              value = generateWeightedValue(23.0, 820.0, 100.0);
              break;
            default:
              value = 1.0;
          }
          values[card.id] = value;
        });
        return values;
      }

      // Generate per-card holo multipliers (range 1.10x - 2.50x, bell-curved around 1.50x)
      const generateHoloMultipliers = () => {
        const multipliers = {};
        ALL_CARDS.forEach(card => {
          multipliers[card.id] = generateWeightedValue(1.10, 2.50, 1.50);
        });
        return multipliers;
      };

      const getBaseMarketValue = (cardId) => {
        return marketValues[cardId] || 1;
      };

      const getHoloMultiplier = (cardId) => {
        return holoMultipliers[cardId] || 1.50;
      };

      const getHoloMarketValue = (cardId) => {
        return getBaseMarketValue(cardId) * getHoloMultiplier(cardId);
      };

      const normalizeCollection = (raw) => {
        const out = {};
        if (!raw || typeof raw !== 'object') return out;
        Object.entries(raw).forEach(([id, val]) => {
          if (typeof val === 'number') {
            if (val > 0) out[id] = { normal: val, holo: 0 };
            return;
          }
          if (val && typeof val === 'object') {
            const normal = Math.max(0, Number(val.normal ?? 0));
            const holo = Math.max(0, Number(val.holo ?? 0));
            if (normal > 0 || holo > 0) out[id] = { normal, holo };
          }
        });
        return out;
      };
;

      // Apply daily market fluctuation
      const fluctuateMarket = (baseValues, currentValues, breakoutCards) => {
        const newValues = {};
        ALL_CARDS.forEach(card => {
          const baseValue = baseValues[card.id];
          const currentValue = currentValues[card.id] || baseValue;
          const isBreakout = breakoutCards.includes(card.id);
          
          // Random fluctuation between -15% and +15%
          const fluctuation = (Math.random() * 0.30) - 0.15; // -0.15 to +0.15
          let newValue = currentValue * (1 + fluctuation);
          
          // 90% of cards stay within 50-150% of base value
          if (!isBreakout) {
            const minBound = baseValue * 0.5;
            const maxBound = baseValue * 1.5;
            newValue = Math.max(minBound, Math.min(maxBound, newValue));
          } else {
            // 10% can break out to 25-200% of base value
            const minBound = baseValue * 0.25;
            const maxBound = baseValue * 2.0;
            newValue = Math.max(minBound, Math.min(maxBound, newValue));
          }
          
          newValues[card.id] = parseFloat(newValue.toFixed(2));
        });
        return newValues;
      };

      // Select 10% of cards from each rarity to be "breakout" cards
      const selectBreakoutCards = () => {
        const breakouts = [];
        Object.keys(CARDS_BY_RARITY).forEach(rarity => {
          const cards = CARDS_BY_RARITY[rarity];
          const count = Math.ceil(cards.length * 0.1);
          const shuffled = [...cards].sort(() => Math.random() - 0.5);
          breakouts.push(...shuffled.slice(0, count).map(c => c.id));
        });
        return breakouts;
      };

      useEffect(() => {
        // Load saved data
        const saved = localStorage.getItem('tcg-collection-v3');
        if (saved) {
          try {
            setCollection(normalizeCollection(JSON.parse(saved)));
          } catch (e) {
            setCollection({});
          }
        }
        
        const savedCount = localStorage.getItem('tcg-pack-count-v3');
        if (savedCount) setPackCount(parseInt(savedCount, 10));
        
        const savedRations = localStorage.getItem('tcg-rations');
        if (savedRations) setRations(parseFloat(savedRations));
        
        const savedPacks = localStorage.getItem('tcg-pack-inventory');
        if (savedPacks) setPackInventory(JSON.parse(savedPacks));
        
        // Initialize or load market values
        let baseValues = localStorage.getItem('tcg-market-base');
        let currentValues = localStorage.getItem('tcg-market-current');
        let breakoutCards = localStorage.getItem('tcg-market-breakouts');
        let lastUpdate = localStorage.getItem('tcg-market-last-update');
        let history = localStorage.getItem('tcg-price-history');
        
        const today = new Date().toDateString();

        // Initialize or load holo multipliers (foil premiums)
        let holoMap = {};
        const savedHolo = localStorage.getItem('tcg-holo-multipliers');
        if (!savedHolo) {
          holoMap = generateHoloMultipliers();
          localStorage.setItem('tcg-holo-multipliers', JSON.stringify(holoMap));
        } else {
          try {
            holoMap = JSON.parse(savedHolo) || {};
          } catch (e) {
            holoMap = {};
          }
          // Fill any missing card IDs (in case new cards were added)
          let didPatch = false;
          ALL_CARDS.forEach(card => {
            if (!holoMap[card.id]) {
              holoMap[card.id] = generateWeightedValue(1.10, 2.50, 1.50);
              didPatch = true;
            }
          });
          if (didPatch) localStorage.setItem('tcg-holo-multipliers', JSON.stringify(holoMap));
        }
        
        // First time setup
        if (!baseValues) {
          baseValues = generateMarketValues();
          currentValues = { ...baseValues };
          breakoutCards = selectBreakoutCards();
          
          localStorage.setItem('tcg-market-base', JSON.stringify(baseValues));
          localStorage.setItem('tcg-market-current', JSON.stringify(currentValues));
          localStorage.setItem('tcg-market-breakouts', JSON.stringify(breakoutCards));
          localStorage.setItem('tcg-market-last-update', today);
          
          // Initialize price history with today's prices
          const initialHistory = {};
          Object.keys(currentValues).forEach(cardId => {
            initialHistory[cardId] = [{ date: today, value: currentValues[cardId] }];
          });
          localStorage.setItem('tcg-price-history', JSON.stringify(initialHistory));
          history = initialHistory;
        } else {
          baseValues = JSON.parse(baseValues);
          currentValues = JSON.parse(currentValues);
          breakoutCards = JSON.parse(breakoutCards);
          history = history ? JSON.parse(history) : {};
          
          // Check if we need to update prices (new day)
          if (lastUpdate !== today) {
            currentValues = fluctuateMarket(baseValues, currentValues, breakoutCards);
            localStorage.setItem('tcg-market-current', JSON.stringify(currentValues));
            localStorage.setItem('tcg-market-last-update', today);
            
            // Update price history (keep last 30 days)
            Object.keys(currentValues).forEach(cardId => {
              if (!history[cardId]) history[cardId] = [];
              history[cardId].push({ date: today, value: currentValues[cardId] });
              
              // Keep only last 30 days
              if (history[cardId].length > 30) {
                history[cardId] = history[cardId].slice(-30);
              }
            });
            localStorage.setItem('tcg-price-history', JSON.stringify(history));
          }
        }
        
        setMarketValues(currentValues);
        setPriceHistory(history);
        setHoloMultipliers(holoMap);
        setIsLoaded(true);
      }, []);

      const saveCollection = useCallback((newCollection) => {
        localStorage.setItem('tcg-collection-v3', JSON.stringify(newCollection));
      }, []);

      const savePackCount = useCallback((count) => {
        localStorage.setItem('tcg-pack-count-v3', String(count));
      }, []);

      const saveRations = useCallback((amount) => {
        localStorage.setItem('tcg-rations', String(amount));
      }, []);

      const savePackInventory = useCallback((packs) => {
        localStorage.setItem('tcg-pack-inventory', JSON.stringify(packs));
      }, []);

      // Generate unique pack ID
      const generatePackId = () => {
        return `pack_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
      };

      // Buy single pack
      const buySinglePack = () => {
        if (rations < 10) return;
        
        const newPack = {
          id: generatePackId(),
          type: 'single'
        };
        
        const newInventory = [...packInventory, newPack];
        const newRations = rations - 10;
        
        setPackInventory(newInventory);
        setRations(newRations);
        savePackInventory(newInventory);
        saveRations(newRations);
      };

      // Buy bundle box (8 packs, 1 guaranteed legendary)
      const buyBundleBox = () => {
        if (rations < 75) return;
        
        const boxId = `bundle_${Date.now()}`;
        const newPacks = [];
        
        // Create 8 packs
        for (let i = 0; i < 8; i++) {
          newPacks.push({
            id: generatePackId(),
            type: 'bundle',
            boxId: boxId
          });
        }
        
        // Randomly assign 1 pack to guarantee legendary
        const luckyIndex = Math.floor(Math.random() * 8);
        newPacks[luckyIndex].forceRarity = 'legendary';
        
        const newInventory = [...packInventory, ...newPacks];
        const newRations = rations - 75;
        
        setPackInventory(newInventory);
        setRations(newRations);
        savePackInventory(newInventory);
        saveRations(newRations);
      };

      // Buy booster box (24 packs, 4 guaranteed legendary)
      const buyBoosterBox = () => {
        if (rations < 200) return;
        
        const boxId = `booster_${Date.now()}`;
        const newPacks = [];
        
        // Create 24 packs
        for (let i = 0; i < 24; i++) {
          newPacks.push({
            id: generatePackId(),
            type: 'booster',
            boxId: boxId
          });
        }
        
        // Randomly assign 4 packs to guarantee legendary
        const indices = Array.from({length: 24}, (_, i) => i);
        const shuffled = indices.sort(() => Math.random() - 0.5);
        for (let i = 0; i < 4; i++) {
          newPacks[shuffled[i]].forceRarity = 'legendary';
        }
        
        const newInventory = [...packInventory, ...newPacks];
        const newRations = rations - 200;
        
        setPackInventory(newInventory);
        setRations(newRations);
        savePackInventory(newInventory);
        saveRations(newRations);
      };

      // Buy booster box case (144 packs, 2 guaranteed ultra x rare)
      const buyBoosterCase = () => {
        if (rations < 1000) return;
        
        const caseId = `case_${Date.now()}`;
        const newPacks = [];
        
        // Create 144 packs (6 boxes  24 packs)
        for (let i = 0; i < 144; i++) {
          newPacks.push({
            id: generatePackId(),
            type: 'case',
            caseId: caseId
          });
        }
        
        // Randomly assign 2 packs to guarantee ultra x rare
        const indices = Array.from({length: 144}, (_, i) => i);
        const shuffled = indices.sort(() => Math.random() - 0.5);
        for (let i = 0; i < 2; i++) {
          newPacks[shuffled[i]].forceRarity = 'ultra x rare';
        }
        
        const newInventory = [...packInventory, ...newPacks];
        const newRations = rations - 1000;
        
        setPackInventory(newInventory);
        setRations(newRations);
        savePackInventory(newInventory);
        saveRations(newRations);
      }

      const confirmPurchase = () => {
        if (!purchaseConfirm) return;
        switch (purchaseConfirm.type) {
          case 'single':
            buySinglePack();
            break;
          case 'bundle':
            buyBundleBox();
            break;
          case 'booster':
            buyBoosterBox();
            break;
          case 'case':
            buyBoosterCase();
            break;
          default:
            break;
        }
        setPurchaseConfirm(null);
      };
;

      const getRandomCard = (rarity) => {
        const cards = CARDS_BY_RARITY[rarity];
        if (!cards || cards.length === 0) return null;
        const card = cards[Math.floor(Math.random() * cards.length)];
        return { ...card, image: getImageUrl(card) };
      };

      const getRareSlotCard = () => {
        const roll = Math.random() * 100;
        if (roll < 1) return getRandomCard('ultra x rare');
        if (roll < 11) return getRandomCard('legendary');
        return getRandomCard('rare');
      }

      // Foil slot distribution:
      // 47% common, 34% uncommon, 13% rare, 5% legendary, 1% ultra x rare
      const getFoilSlotCard = () => {
        const roll = Math.random() * 100;
        if (roll < 47) return getRandomCard('common');
        if (roll < 81) return getRandomCard('uncommon');
        if (roll < 94) return getRandomCard('rare');
        if (roll < 99) return getRandomCard('legendary');
        return getRandomCard('ultra x rare');
      }
;

      const openPack = () => {
        // Check if we have packs
        if (packInventory.length === 0) return;

        // Take the first pack from inventory
        const packToOpen = packInventory[0];
        const newInventory = packInventory.slice(1);

        const newPack = [];

        // Generate 7 commons
        for (let i = 0; i < 7; i++) {
          const card = getRandomCard('common');
          if (card) newPack.push({ ...card, slot: i });
        }

        // Generate 5 uncommons
        for (let i = 0; i < 5; i++) {
          const card = getRandomCard('uncommon');
          if (card) newPack.push({ ...card, slot: 7 + i });
        }

        // Generate 2 rare+ slots
        if (packToOpen.forceRarity) {
          // First slot is guaranteed rarity
          const guaranteedCard = getRandomCard(packToOpen.forceRarity);
          if (guaranteedCard) newPack.push({ ...guaranteedCard, slot: 12 });

          // Second slot is normal rare+
          const card = getRareSlotCard();
          if (card) newPack.push({ ...card, slot: 13 });
        } else {
          // Both slots are normal rare+
          for (let i = 0; i < 2; i++) {
            const card = getRareSlotCard();
            if (card) newPack.push({ ...card, slot: 12 + i });
          }
        }

        // Foil (holo) slot
        const foilCard = getFoilSlotCard();
        if (foilCard) newPack.push({ ...foilCard, slot: 14, isHolo: true, isFoilSlot: true });

        // Preload all images in the pack for instant display
        newPack.forEach(card => {
          const img = new Image();
          img.src = card.image;
        });

        // Update state
        setPackInventory(newInventory);
        savePackInventory(newInventory);
        setPackCards(newPack);
        setRevealedCards([]);
        setAllRevealed(false);
        setView('opening');
        const newCount = packCount + 1;
        setPackCount(newCount);
        savePackCount(newCount);
      };

      const revealCard = (index) => {
        if (revealedCards.includes(index)) return;
        const newRevealed = [...revealedCards, index];
        setRevealedCards(newRevealed);
        const card = packCards[index];
        if (card) {
          const newCollection = { ...collection };
          const entry = newCollection[card.id] || { normal: 0, holo: 0 };
          if (card.isHolo) entry.holo += 1;
          else entry.normal += 1;
          newCollection[card.id] = entry;
          setCollection(newCollection);
          saveCollection(newCollection);
        }
        if (newRevealed.length === packCards.length) setAllRevealed(true);
      };

      const revealAll = () => {
        const newCollection = { ...collection };
        packCards.forEach((card, index) => {
          if (!revealedCards.includes(index)) {
            const entry = newCollection[card.id] || { normal: 0, holo: 0 };
            if (card.isHolo) entry.holo += 1;
            else entry.normal += 1;
            newCollection[card.id] = entry;
          }
        });
        setRevealedCards(packCards.map((_, i) => i));
        setCollection(newCollection);
        saveCollection(newCollection);
        setAllRevealed(true);
      };

      const getCollectionStats = () => {
        const totalCards = ALL_CARDS.length;
        const uniqueOwned = Object.entries(collection).filter(([_, e]) => ((e?.normal || 0) + (e?.holo || 0)) > 0).length;
        const totalOwned = Object.values(collection).reduce((sum, e) => sum + (e?.normal || 0) + (e?.holo || 0), 0);
        const byRarity = {};
        for (const rarity of RARITY_ORDER) {
          const rarityCards = CARDS_BY_RARITY[rarity] || [];
          const owned = rarityCards.filter(c => {
            const e = collection[c.id];
            return e && ((e.normal || 0) + (e.holo || 0)) > 0;
          }).length;
          byRarity[rarity] = { owned, total: rarityCards.length };
        }
        return { uniqueOwned, totalCards, totalOwned, byRarity };
      };

      const sellNormalCard = (cardId) => {
        const entry = collection[cardId];
        if (!entry || (entry.normal || 0) === 0) return;

        const marketValue = getBaseMarketValue(cardId);
        const newCollection = { ...collection };
        const nextEntry = { ...(newCollection[cardId] || { normal: 0, holo: 0 }) };
        nextEntry.normal = Math.max(0, (nextEntry.normal || 0) - 1);
        if ((nextEntry.normal || 0) + (nextEntry.holo || 0) === 0) delete newCollection[cardId];
        else newCollection[cardId] = nextEntry;

        const newRations = rations + marketValue;

        setCollection(newCollection);
        setRations(newRations);
        saveCollection(newCollection);
        saveRations(newRations);
        setSellConfirm(null);
      };

      const sellHoloCard = (cardId) => {
        const entry = collection[cardId];
        if (!entry || (entry.holo || 0) === 0) return;

        const marketValue = getHoloMarketValue(cardId);
        const newCollection = { ...collection };
        const nextEntry = { ...(newCollection[cardId] || { normal: 0, holo: 0 }) };
        nextEntry.holo = Math.max(0, (nextEntry.holo || 0) - 1);
        if ((nextEntry.normal || 0) + (nextEntry.holo || 0) === 0) delete newCollection[cardId];
        else newCollection[cardId] = nextEntry;

        const newRations = rations + marketValue;

        setCollection(newCollection);
        setRations(newRations);
        saveCollection(newCollection);
        saveRations(newRations);
        setSellConfirm(null);
      };;

            const getCollectionCards = () => {
        let cards = [...ALL_CARDS];

        // Rarity filter (quick buttons)
        if (collectionFilter !== 'all') {
          cards = cards.filter(c => c.rarity === collectionFilter);
        }

        // Search filter (name)
        const q = (collectionSearch || '').trim().toLowerCase();
        if (q) {
          cards = cards.filter(c => (c.name || '').toLowerCase().includes(q));
        }

        // Enrich with ownership + market data
        let enriched = cards.map(card => {
          const entry = collection[card.id] || { normal: 0, holo: 0 };
          const ownedNormal = entry.normal || 0;
          const ownedHolo = entry.holo || 0;
          const owned = ownedNormal + ownedHolo;

          const marketValue = marketValues[card.id] || 1;
          const holoMult = getHoloMultiplier(card.id);
          const holoValue = marketValue * holoMult;

          const history = priceHistory[card.id] || [];
          let priceChange = 0;
          if (history.length >= 2) {
            const prev = history[history.length - 2].value || 1;
            const curr = history[history.length - 1].value || marketValue;
            priceChange = prev ? ((curr - prev) / prev) * 100 : 0;
          }

          return {
            ...card,
            image: getImageUrl(card),
            owned,
            ownedNormal,
            ownedHolo,
            marketValue,
            holoMult,
            holoValue,
            priceChange
          };
        });

        // Owned / unowned / hide unknown filters
        if (hideUnknown) {
          enriched = enriched.filter(c => c.owned > 0);
        }

        if (ownedFilter === 'owned') {
          enriched = enriched.filter(c => c.owned > 0);
        } else if (ownedFilter === 'unowned') {
          enriched = enriched.filter(c => c.owned === 0);
        }

        if (holoFilter === 'hasHolo') {
          enriched = enriched.filter(c => c.ownedHolo > 0);
        } else if (holoFilter === 'noHolo') {
          enriched = enriched.filter(c => c.ownedHolo === 0);
        }

        const dir = sortDir === 'asc' ? 1 : -1;
        const rarityIndex = (r) => {
          const i = RARITY_ORDER.indexOf(r);
          return i === -1 ? 999 : i;
        };

        enriched.sort((a, b) => {
          // Always keep things stable by breaking ties on name
          const tieByName = () => a.name.localeCompare(b.name);

          switch (sortKey) {
            case 'name':
              return a.name.localeCompare(b.name) * dir;
            case 'rarity': {
              const d = (rarityIndex(a.rarity) - rarityIndex(b.rarity)) * dir;
              return d !== 0 ? d : tieByName();
            }
            case 'value': {
              const d = (a.marketValue - b.marketValue) * dir;
              return d !== 0 ? d : tieByName();
            }
            case 'holoValue': {
              const d = (a.holoValue - b.holoValue) * dir;
              return d !== 0 ? d : tieByName();
            }
            case 'change': {
              const d = (a.priceChange - b.priceChange) * dir;
              return d !== 0 ? d : tieByName();
            }
            case 'holoMult': {
              const d = (a.holoMult - b.holoMult) * dir;
              return d !== 0 ? d : tieByName();
            }
            case 'owned':
            default: {
              const d = (a.owned - b.owned) * dir;
              // If owned counts are tied, keep owned cards above unknown by default
              if (d !== 0) return d;
              const d2 = (a.owned > 0 ? -1 : 1) - (b.owned > 0 ? -1 : 1);
              return d2 !== 0 ? d2 : tieByName();
            }
          }
        });

        return enriched;
      };
          const ownedNormal = entry.normal || 0;
          const ownedHolo = entry.holo || 0;
          const owned = ownedNormal + ownedHolo;
          return {
            ...card,
            image: getImageUrl(card),
            owned,
            ownedNormal,
            ownedHolo
          };
        }).sort((a, b) => {
          if (a.owned > 0 && b.owned === 0) return -1;
          if (b.owned > 0 && a.owned === 0) return 1;
          return 0;
        });
      };

      if (!isLoaded) {
        return (
          <div style={{ minHeight: '100vh', background: '#111827', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
            <div style={{ textAlign: 'center', color: 'white' }}>
              <div style={{ width: 64, height: 64, border: '4px solid #a855f7', borderTopColor: 'transparent', borderRadius: '50%', animation: 'spin 1s linear infinite', margin: '0 auto 16px' }}></div>
              <p style={{ fontSize: 20 }}>Loading...</p>
            </div>
          </div>
        );
      }

      const stats = getCollectionStats();

      return (
        <div style={{ minHeight: '100vh', background: 'linear-gradient(135deg, #111827 0%, #2e1065 50%, #111827 100%)' }}>
          <header style={{ background: 'rgba(0,0,0,0.4)', borderBottom: '1px solid rgba(168,85,247,0.3)', padding: '12px 16px', position: 'sticky', top: 0, zIndex: 50 }}>
            <div style={{ maxWidth: 1200, margin: '0 auto', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
              <h1 style={{ fontSize: 24, fontWeight: 'bold', background: 'linear-gradient(90deg, #a855f7, #ec4899)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', margin: 0 }}>
                Through The Ages
              </h1>
              <div style={{ display: 'flex', alignItems: 'center', gap: 16 }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: 8, padding: '6px 12px', background: 'rgba(168,85,247,0.2)', borderRadius: 8, border: '1px solid rgba(168,85,247,0.4)' }}>
                  <img src="./rations.png" alt="Rations" style={{ width: 24, height: 24 }} />
                  <span style={{ color: '#fbbf24', fontSize: 18, fontWeight: 'bold' }}>{rations.toFixed(2)}</span>
                </div>
                <nav style={{ display: 'flex', gap: 8 }}>
                <button onClick={() => setView('home')} style={{ padding: '8px 16px', borderRadius: 8, border: 'none', cursor: 'pointer', background: view === 'home' || view === 'opening' ? '#9333ea' : 'rgba(107,114,128,0.5)', color: 'white', fontSize: 14 }}>
                  Open Packs
                </button>
                <button onClick={() => setView('shop')} style={{ padding: '8px 16px', borderRadius: 8, border: 'none', cursor: 'pointer', background: view === 'shop' ? '#9333ea' : 'rgba(107,114,128,0.5)', color: 'white', fontSize: 14 }}>
                  Shop
                </button>
                <button onClick={() => setView('collection')} style={{ padding: '8px 16px', borderRadius: 8, border: 'none', cursor: 'pointer', background: view === 'collection' ? '#9333ea' : 'rgba(107,114,128,0.5)', color: 'white', fontSize: 14 }}>
                  Collection ({stats.uniqueOwned}/{stats.totalCards})
                </button>
              </nav>
              </div>
            </div>
          </header>

          <main style={{ maxWidth: 1200, margin: '0 auto', padding: 32 }}>
            {view === 'home' && (
              <div style={{ textAlign: 'center' }}>
                <p style={{ color: '#9ca3af', marginBottom: 8 }}>Packs Opened: {packCount}</p>
                <p style={{ color: '#9ca3af', marginBottom: 8 }}>Total Cards: {stats.totalOwned}</p>
                <p style={{ color: '#fbbf24', fontSize: 20, fontWeight: 'bold', marginBottom: 32 }}>
                  Packs Available: {packInventory.length}
                </p>
                
                {packInventory.length > 0 ? (
                  <div onClick={openPack} style={{ width: 256, height: 384, margin: '0 auto', cursor: 'pointer', position: 'relative' }}>
                    <img 
                      src="./cardback.png" 
                      alt="Booster Pack" 
                      style={{ 
                        width: '100%', 
                        height: '100%', 
                        objectFit: 'cover', 
                        borderRadius: 16, 
                        border: '3px solid rgba(168,85,247,0.5)',
                        boxShadow: '0 25px 50px -12px rgba(168,85,247,0.5)',
                        transition: 'transform 0.2s, box-shadow 0.2s'
                      }}
                      onMouseEnter={(e) => {
                        e.currentTarget.style.transform = 'scale(1.05)';
                        e.currentTarget.style.boxShadow = '0 30px 60px -12px rgba(168,85,247,0.7)';
                      }}
                      onMouseLeave={(e) => {
                        e.currentTarget.style.transform = 'scale(1)';
                        e.currentTarget.style.boxShadow = '0 25px 50px -12px rgba(168,85,247,0.5)';
                      }}
                    />
                    <div style={{ position: 'absolute', bottom: 16, left: 0, right: 0, textAlign: 'center', pointerEvents: 'none' }}>
                      <p style={{ color: 'white', fontSize: 14, margin: 0, textShadow: '0 2px 4px rgba(0,0,0,0.8)' }}>Click to Open</p>
                    </div>
                  </div>
                ) : (
                  <div style={{ width: 256, height: 384, margin: '0 auto', position: 'relative', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', background: 'rgba(107,114,128,0.2)', borderRadius: 16, border: '3px dashed rgba(168,85,247,0.5)' }}>
                    <p style={{ color: '#9ca3af', fontSize: 18, fontWeight: 'bold', marginBottom: 16 }}>No Packs Available</p>
                    <button 
                      onClick={() => setView('shop')}
                      style={{
                        padding: '12px 24px',
                        background: 'linear-gradient(90deg, #9333ea, #ec4899)',
                        color: 'white',
                        border: 'none',
                        borderRadius: 8,
                        cursor: 'pointer',
                        fontSize: 16,
                        fontWeight: 'bold'
                      }}
                    >
                      Visit Shop
                    </button>
                  </div>
                )}
              </div>
            )}

            {view === 'shop' && (
              <div>
                <h2 style={{ color: 'white', fontSize: 28, fontWeight: 'bold', marginBottom: 32, textAlign: 'center' }}>
                  Shop
                </h2>
                
                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: 24, maxWidth: 1200 }}>
                  {/* Single Pack */}
                  <div style={{
                    background: 'rgba(31,41,55,0.8)',
                    borderRadius: 16,
                    padding: 24,
                    border: '2px solid rgba(168,85,247,0.3)',
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center'
                  }}>
                    <img 
                      src="./cardback.png" 
                      alt="Single Pack"
                      style={{ width: 180, height: 270, objectFit: 'cover', borderRadius: 12, marginBottom: 16 }}
                    />
                    <h3 style={{ color: 'white', fontSize: 20, fontWeight: 'bold', margin: '0 0 8px' }}>Single Pack</h3>
                    <p style={{ color: '#9ca3af', fontSize: 14, margin: '0 0 16px', textAlign: 'center' }}>15 cards</p>
                    
                    <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 16 }}>
                      <img src="./rations.png" alt="R" style={{ width: 24, height: 24 }} />
                      <span style={{ color: '#fbbf24', fontSize: 24, fontWeight: 'bold' }}>10</span>
                    </div>
                    
                    <button
                      onClick={() => setPurchaseConfirm({ type: 'single', title: 'Single Pack', cost: 10, details: '15 cards: 7 Common, 5 Uncommon, 2 Rare+ (89% Rare / 10% Legendary / 1% Ultra X Rare), 1 Holo slot (47%C / 34%U / 13%R / 5%L / 1% UXR).' })}
                      disabled={rations < 10}
                      style={{
                        width: '100%',
                        padding: '12px',
                        background: rations >= 10 ? 'linear-gradient(90deg, #9333ea, #ec4899)' : '#374151',
                        color: 'white',
                        border: 'none',
                        borderRadius: 8,
                        cursor: rations >= 10 ? 'pointer' : 'not-allowed',
                        fontSize: 16,
                        fontWeight: 'bold',
                        opacity: rations >= 10 ? 1 : 0.5
                      }}
                    >
                      {rations >= 10 ? 'Buy Pack' : 'Not Enough Rations'}
                    </button>
                  </div>

                  {/* Bundle Box */}
                  <div style={{
                    background: 'rgba(31,41,55,0.8)',
                    borderRadius: 16,
                    padding: 24,
                    border: '2px solid rgba(16,185,129,0.5)',
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center'
                  }}>
                    <img 
                      src="./cardback.png" 
                      alt="Bundle Box"
                      style={{ width: 180, height: 270, objectFit: 'cover', borderRadius: 12, marginBottom: 16 }}
                    />
                    <h3 style={{ color: '#10b981', fontSize: 20, fontWeight: 'bold', margin: '0 0 8px' }}>Bundle Box</h3>
                    <p style={{ color: '#9ca3af', fontSize: 14, margin: '0 0 4px', textAlign: 'center' }}>8 packs (120 cards)</p>
                    <p style={{ color: '#10b981', fontSize: 12, fontWeight: 'bold', margin: '0 0 16px', textAlign: 'center' }}>
                       1 Legendary Guaranteed
                    </p>
                    
                    <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 16 }}>
                      <img src="./rations.png" alt="R" style={{ width: 24, height: 24 }} />
                      <span style={{ color: '#fbbf24', fontSize: 24, fontWeight: 'bold' }}>75</span>
                    </div>
                    
                    <button
                      onClick={() => setPurchaseConfirm({ type: 'bundle', title: 'Bundle Box (8 Packs)', cost: 75, details: '8 packs. One pack is guaranteed a Legendary in a rare slot.' })}
                      disabled={rations < 75}
                      style={{
                        width: '100%',
                        padding: '12px',
                        background: rations >= 75 ? 'linear-gradient(90deg, #10b981, #059669)' : '#374151',
                        color: 'white',
                        border: 'none',
                        borderRadius: 8,
                        cursor: rations >= 75 ? 'pointer' : 'not-allowed',
                        fontSize: 16,
                        fontWeight: 'bold',
                        opacity: rations >= 75 ? 1 : 0.5
                      }}
                    >
                      {rations >= 75 ? 'Buy Bundle' : 'Not Enough Rations'}
                    </button>
                  </div>

                  {/* Booster Box */}
                  <div style={{
                    background: 'rgba(31,41,55,0.8)',
                    borderRadius: 16,
                    padding: 24,
                    border: '2px solid rgba(59,130,246,0.5)',
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center'
                  }}>
                    <img 
                      src="./cardback.png" 
                      alt="Booster Box"
                      style={{ width: 180, height: 270, objectFit: 'cover', borderRadius: 12, marginBottom: 16 }}
                    />
                    <h3 style={{ color: '#3b82f6', fontSize: 20, fontWeight: 'bold', margin: '0 0 8px' }}>Booster Box</h3>
                    <p style={{ color: '#9ca3af', fontSize: 14, margin: '0 0 4px', textAlign: 'center' }}>24 packs (360 cards)</p>
                    <p style={{ color: '#3b82f6', fontSize: 12, fontWeight: 'bold', margin: '0 0 16px', textAlign: 'center' }}>
                       4 Legendaries Guaranteed
                    </p>
                    
                    <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 16 }}>
                      <img src="./rations.png" alt="R" style={{ width: 24, height: 24 }} />
                      <span style={{ color: '#fbbf24', fontSize: 24, fontWeight: 'bold' }}>200</span>
                    </div>
                    
                    <button
                      onClick={() => setPurchaseConfirm({ type: 'booster', title: 'Booster Box (24 Packs)', cost: 200, details: '24 packs. One pack is guaranteed an Ultra X Rare in a rare slot.' })}
                      disabled={rations < 200}
                      style={{
                        width: '100%',
                        padding: '12px',
                        background: rations >= 200 ? 'linear-gradient(90deg, #3b82f6, #2563eb)' : '#374151',
                        color: 'white',
                        border: 'none',
                        borderRadius: 8,
                        cursor: rations >= 200 ? 'pointer' : 'not-allowed',
                        fontSize: 16,
                        fontWeight: 'bold',
                        opacity: rations >= 200 ? 1 : 0.5
                      }}
                    >
                      {rations >= 200 ? 'Buy Box' : 'Not Enough Rations'}
                    </button>
                  </div>

                  {/* Booster Box Case */}
                  <div style={{
                    background: 'rgba(31,41,55,0.8)',
                    borderRadius: 16,
                    padding: 24,
                    border: '2px solid rgba(251,191,36,0.5)',
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center'
                  }}>
                    <img 
                      src="./cardback.png" 
                      alt="Booster Box Case"
                      style={{ width: 180, height: 270, objectFit: 'cover', borderRadius: 12, marginBottom: 16 }}
                    />
                    <h3 style={{ color: '#fbbf24', fontSize: 20, fontWeight: 'bold', margin: '0 0 8px' }}>Booster Case</h3>
                    <p style={{ color: '#9ca3af', fontSize: 14, margin: '0 0 4px', textAlign: 'center' }}>144 packs (2160 cards)</p>
                    <p style={{ color: '#fbbf24', fontSize: 12, fontWeight: 'bold', margin: '0 0 16px', textAlign: 'center' }}>
                       2 Ultra X Rares Guaranteed
                    </p>
                    
                    <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 16 }}>
                      <img src="./rations.png" alt="R" style={{ width: 24, height: 24 }} />
                      <span style={{ color: '#fbbf24', fontSize: 24, fontWeight: 'bold' }}>1000</span>
                    </div>
                    
                    <button
                      onClick={() => setPurchaseConfirm({ type: 'case', title: 'Booster Case (144 Packs)', cost: 1000, details: '144 packs (6 boxes). Two packs are guaranteed an Ultra X Rare in a rare slot.' })}
                      disabled={rations < 1000}
                      style={{
                        width: '100%',
                        padding: '12px',
                        background: rations >= 1000 ? 'linear-gradient(90deg, #fbbf24, #f59e0b)' : '#374151',
                        color: 'white',
                        border: 'none',
                        borderRadius: 8,
                        cursor: rations >= 1000 ? 'pointer' : 'not-allowed',
                        fontSize: 16,
                        fontWeight: 'bold',
                        opacity: rations >= 1000 ? 1 : 0.5
                      }}
                    >
                      {rations >= 1000 ? 'Buy Case' : 'Not Enough Rations'}
                    </button>
                  </div>
                </div>
              </div>
            )}

            {view === 'opening' && (
              <div>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 24 }}>
                  <h2 style={{ color: 'white', fontSize: 24, fontWeight: 'bold', margin: 0 }}>Pack #{packCount}</h2>
                  <div style={{ display: 'flex', gap: 12 }}>
                    {!allRevealed && (
                      <button onClick={revealAll} style={{ padding: '8px 16px', background: '#9333ea', color: 'white', border: 'none', borderRadius: 8, cursor: 'pointer' }}>
                        Reveal All
                      </button>
                    )}
                    {allRevealed && (
                      <button onClick={openPack} style={{ padding: '8px 16px', background: 'linear-gradient(90deg, #9333ea, #ec4899)', color: 'white', border: 'none', borderRadius: 8, cursor: 'pointer' }}>
                        Open Another Pack
                      </button>
                    )}
                    <button onClick={() => setView('home')} style={{ padding: '8px 16px', background: '#374151', color: 'white', border: 'none', borderRadius: 8, cursor: 'pointer' }}>
                      Back
                    </button>
                  </div>
                </div>

                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)', gap: 16 }}>
                  {packCards.map((card, index) => {
                    const isRevealed = revealedCards.includes(index);
                    const colors = RARITY_COLORS[card.rarity];
                    
                    return (
                      <div 
                        key={`${card.id}-${index}`} 
                        onClick={() => revealCard(index)} 
                        className={card.isHolo ? 'foil-glow' : ''} style={{ aspectRatio: '2.5/3.5', cursor: 'pointer', perspective: 1000, position: 'relative', overflow: 'visible' }}
                        title={isRevealed ? card.name : ''}
                      >
                        <div className={`card-flip ${isRevealed ? 'flipped' : ''}`} style={{ width: '100%', height: '100%', position: 'relative' }}>
                          <div className="card-face" style={{ width: '100%', height: '100%', borderRadius: 12, border: '3px solid #a855f7', overflow: 'hidden', position: 'relative' }}>
                            <img 
                              src="./cardback.png" 
                              alt="Card Back"
                              style={{ width: '100%', height: '100%', objectFit: 'cover' }}
                            />
                            <div style={{ position: 'absolute', bottom: 8, left: 0, right: 0, textAlign: 'center' }}>
                              <p style={{ color: 'white', fontSize: 11, margin: 0, textShadow: '0 2px 4px rgba(0,0,0,0.8)' }}>Click to reveal</p>
                            </div>
                          </div>
                          
                          <div 
                            className="card-face card-back" 
                            style={{ width: '100%', height: '100%', borderRadius: 12, border: `3px solid ${colors.border}`, overflow: 'hidden', background: '#1f2937', cursor: 'zoom-in' }}
                            onClick={(e) => {
                              e.stopPropagation();
                              if (isRevealed) setEnlargedCard(card);
                            }}
                          >
                            <img 
                              src={card.image} 
                              alt={card.name} 
                              style={{ width: '100%', height: '100%', objectFit: 'cover' }}
                              loading="lazy"
                            />
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}

            {view === 'collection' && (
              <div>
                <div style={{ background: 'rgba(0,0,0,0.3)', borderRadius: 12, padding: 24, marginBottom: 24 }}>
                  <div style={{ display: 'grid', gridTemplateColumns: 'repeat(6, 1fr)', gap: 16, textAlign: 'center' }}>
                    <div>
                      <p style={{ color: '#9ca3af', fontSize: 14, margin: 0 }}>Unique</p>
                      <p style={{ color: 'white', fontSize: 24, fontWeight: 'bold', margin: '4px 0 0' }}>{stats.uniqueOwned}/{stats.totalCards}</p>
                    </div>
                    {RARITY_ORDER.map(rarity => (
                      <div key={rarity}>
                        <p style={{ color: RARITY_COLORS[rarity].text, fontSize: 14, textTransform: 'capitalize', margin: 0 }}>{rarity}</p>
                        <p style={{ color: 'white', fontSize: 20, fontWeight: 'bold', margin: '4px 0 0' }}>
                          {stats.byRarity[rarity]?.owned || 0}/{stats.byRarity[rarity]?.total || 0}
                        </p>
                      </div>
                    ))}
                  </div>
                </div>

                                <div style={{ background: 'rgba(0,0,0,0.28)', border: '1px solid rgba(255,255,255,0.08)', borderRadius: 12, padding: 16, marginBottom: 20 }}>
                  <div style={{ display: 'grid', gridTemplateColumns: '1.4fr 0.9fr 0.9fr 1fr auto', gap: 12, alignItems: 'center', marginBottom: 12 }}>
                    <input
                      value={collectionSearch}
                      onChange={(e) => setCollectionSearch(e.target.value)}
                      placeholder="Search cards"
                      style={{ 
                        padding: '10px 12px',
                        borderRadius: 10,
                        border: '1px solid rgba(255,255,255,0.10)',
                        background: 'rgba(17,24,39,0.85)',
                        color: 'white',
                        outline: 'none'
                      }}
                    />

                    <select
                      value={ownedFilter}
                      onChange={(e) => setOwnedFilter(e.target.value)}
                      style={{ 
                        padding: '10px 12px',
                        borderRadius: 10,
                        border: '1px solid rgba(255,255,255,0.10)',
                        background: 'rgba(17,24,39,0.85)',
                        color: 'white',
                        outline: 'none'
                      }}
                    >
                      <option value="all">All cards</option>
                      <option value="owned">Owned</option>
                      <option value="unowned">Unowned</option>
                    </select>

                    <select
                      value={holoFilter}
                      onChange={(e) => setHoloFilter(e.target.value)}
                      style={{ 
                        padding: '10px 12px',
                        borderRadius: 10,
                        border: '1px solid rgba(255,255,255,0.10)',
                        background: 'rgba(17,24,39,0.85)',
                        color: 'white',
                        outline: 'none'
                      }}
                    >
                      <option value="all">Holo: Any</option>
                      <option value="hasHolo">Has holo</option>
                      <option value="noHolo">No holo</option>
                    </select>

                    <select
                      value={sortKey}
                      onChange={(e) => setSortKey(e.target.value)}
                      style={{ 
                        padding: '10px 12px',
                        borderRadius: 10,
                        border: '1px solid rgba(255,255,255,0.10)',
                        background: 'rgba(17,24,39,0.85)',
                        color: 'white',
                        outline: 'none'
                      }}
                    >
                      <option value="owned">Sort: Owned</option>
                      <option value="name">Sort: Name</option>
                      <option value="rarity">Sort: Rarity</option>
                      <option value="value">Sort: Market Value</option>
                      <option value="holoValue">Sort: Holo Value</option>
                      <option value="change">Sort: 24h Change</option>
                      <option value="holoMult">Sort: Holo Multiplier</option>
                    </select>

                    <button
                      onClick={() => setSortDir(sortDir === 'asc' ? 'desc' : 'asc')}
                      style={{
                        padding: '10px 12px',
                        borderRadius: 10,
                        border: '1px solid rgba(255,255,255,0.10)',
                        background: 'rgba(55,65,81,0.85)',
                        color: 'white',
                        cursor: 'pointer',
                        fontWeight: 800,
                        minWidth: 44
                      }}
                      title="Toggle sort direction"
                    >
                      {sortDir === 'asc' ? '' : ''}
                    </button>
                  </div>

                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', gap: 12, flexWrap: 'wrap' }}>
                    <div style={{ display: 'flex', gap: 8, flexWrap: 'wrap' }}>
                      <button onClick={() => setCollectionFilter('all')} style={{ padding: '8px 16px', borderRadius: 8, border: 'none', cursor: 'pointer', background: collectionFilter === 'all' ? '#9333ea' : '#374151', color: 'white' }}>
                        All
                      </button>
                      {RARITY_ORDER.map(rarity => (
                        <button key={rarity} onClick={() => setCollectionFilter(rarity)} style={{ padding: '8px 16px', borderRadius: 8, border: 'none', cursor: 'pointer', background: collectionFilter === rarity ? RARITY_COLORS[rarity].bg : '#374151', color: 'white', textTransform: 'capitalize' }}>
                          {rarity}
                        </button>
                      ))}
                    </div>

                    <label style={{ display: 'flex', alignItems: 'center', gap: 8, color: '#e5e7eb', fontSize: 13, userSelect: 'none' }}>
                      <input type="checkbox" checked={hideUnknown} onChange={(e) => setHideUnknown(e.target.checked)} />
                      Hide unknown
                    </label>
                  </div>
                </div>

                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(6, 1fr)', gap: 16 }}>
                  {getCollectionCards().map(card => {
                    const colors = RARITY_COLORS[card.rarity];
                    const marketValue = (typeof card.marketValue === 'number') ? card.marketValue : (marketValues[card.id] || 1);
                    const priceChange = (typeof card.priceChange === 'number') ? card.priceChange : 0;
                    const holoMult = getHoloMultiplier(card.id);
                    const holoValue = marketValue * holoMult;
return (
                      <div 
                        key={card.id} 
                        style={{ 
                          aspectRatio: '2.5/3.5', 
                          borderRadius: 12, 
                          border: `3px solid ${colors.border}`, 
                          overflow: 'visible', 
                          background: '#1f2937', 
                          position: 'relative', 
                          opacity: card.owned === 0 ? 0.4 : 1,
                        }}
                        title={card.owned > 0 ? `${card.name} - ${marketValue.toFixed(2)}` : '???'}
                      >
                        <div 
                          style={{ width: '100%', height: '100%', borderRadius: 12, overflow: 'hidden', cursor: card.owned > 0 ? 'zoom-in' : 'default' }}
                          onClick={() => {
                            if (card.owned > 0) setEnlargedCard({ ...card, marketValue, priceChange });
                          }}
                        >
                          {card.owned > 0 ? (
                            <img 
                              src={card.image} 
                              alt={card.name} 
                              style={{ width: '100%', height: '100%', objectFit: 'cover' }}
                              loading="lazy"
                            />
                          ) : (
                            <div style={{ width: '100%', height: '100%', display: 'flex', alignItems: 'center', justifyContent: 'center', background: '#111827' }}>
                              <span style={{ fontSize: 48 }}></span>
                            </div>
                          )}
                        </div>
                        
                        {card.owned > 0 && (
                          <>
                            {/* Count badges */}
                            <div style={{ position: 'absolute', top: 8, right: 8, display: 'flex', gap: 6, zIndex: 5 }}>
                              {card.ownedNormal > 0 && (
                                <div style={{ 
                                  background: 'rgba(0,0,0,0.55)', 
                                  padding: '4px 8px', 
                                  borderRadius: 12, 
                                  border: `2px solid ${colors.border}`,
                                  color: 'white',
                                  fontWeight: 800,
                                  fontSize: 12,
                                  textShadow: '0 1px 2px rgba(0,0,0,0.85)'
                                }}>
                                  x{card.ownedNormal}
                                </div>
                              )}
                              {card.ownedHolo > 0 && (
                                <div className="holo-badge" style={{ 
                                  padding: '4px 8px', 
                                  borderRadius: 12,
                                  border: `2px solid ${colors.border}`,
                                  fontWeight: 800,
                                  fontSize: 12
                                }}>
                                  x{card.ownedHolo}
                                </div>
                              )}
                            </div>
                            
                            {/* Market value + change */}
                            <div style={{ position: 'absolute', top: 8, left: 8, background: 'rgba(0,0,0,0.8)', padding: '4px 8px', borderRadius: 8, display: 'flex', flexDirection: 'column', alignItems: 'flex-start', gap: 2 }}>
                              <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                                <img src="./rations.png" alt="R" style={{ width: 14, height: 14 }} />
                                <span style={{ color: '#fbbf24', fontSize: 12, fontWeight: 'bold' }}>{marketValue.toFixed(2)}</span>
                              </div>
                              {priceChange !== 0 && (
                                <span style={{ fontSize: 10, fontWeight: 'bold', color: priceChange > 0 ? '#10b981' : '#ef4444' }}>
                                  {priceChange > 0 ? '' : ''} {Math.abs(priceChange).toFixed(1)}%
                                </span>
                              )}
                            </div>
                            
                            {/* Sell button */}
                            <button
                              onClick={(e) => {
                                e.stopPropagation();
                                setSellConfirm({ id: card.id, name: card.name, rarity: card.rarity });
                              }}
                              style={{
                                position: 'absolute',
                                bottom: 8,
                                left: '50%',
                                transform: 'translateX(-50%)',
                                padding: '6px 16px',
                                background: 'linear-gradient(90deg, #dc2626, #b91c1c)',
                                color: 'white',
                                border: 'none',
                                borderRadius: 8,
                                cursor: 'pointer',
                                fontSize: 12,
                                fontWeight: 'bold',
                                boxShadow: '0 2px 8px rgba(0,0,0,0.4)',
                                transition: 'transform 0.2s'
                              }}
                              onMouseEnter={(e) => e.currentTarget.style.transform = 'translateX(-50%) scale(1.05)'}
                              onMouseLeave={(e) => e.currentTarget.style.transform = 'translateX(-50%) scale(1)'}
                            >
                              Sell
                            </button>
                          </>
                        )}
                      </div>
                    );
                  })}
                </div>
              </div>
            )}
          </main>

          {/* Enlarged Card Modal */}
          {enlargedCard && (
            <div 
              onClick={() => setEnlargedCard(null)}
              style={{
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                background: 'rgba(0, 0, 0, 0.9)',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                zIndex: 1000,
                cursor: 'zoom-out',
                padding: 32
              }}
            >
              <div style={{ display: 'flex', gap: 24, alignItems: 'center', maxWidth: '95vw' }} onClick={(e) => e.stopPropagation()}>
                {/* Card Image */}
                <div style={{ position: 'relative' }}>
                  <img 
                    src={enlargedCard.image} 
                    alt={enlargedCard.name}
                    style={{
                      maxWidth: '500px',
                      maxHeight: '80vh',
                      objectFit: 'contain',
                      borderRadius: 16,
                      border: `4px solid ${RARITY_COLORS[enlargedCard.rarity].border}`,
                      boxShadow: `0 0 40px ${RARITY_COLORS[enlargedCard.rarity].border}`,
                      cursor: 'default'
                    }}
                  />
                </div>
                
                {/* Price Info Panel */}
                <div style={{
                  background: 'rgba(0,0,0,0.8)',
                  padding: 24,
                  borderRadius: 16,
                  border: `2px solid ${RARITY_COLORS[enlargedCard.rarity].border}`,
                  minWidth: 300,
                  maxWidth: 400
                }}>
                  <h2 style={{ color: 'white', fontSize: 24, fontWeight: 'bold', margin: '0 0 8px' }}>{enlargedCard.name}</h2>
                  <p style={{ color: RARITY_COLORS[enlargedCard.rarity].text, fontSize: 16, textTransform: 'capitalize', margin: '0 0 24px' }}>
                    {enlargedCard.rarity}
                  </p>
                  
                  {/* Market Values */}
                  {(() => {
                    const baseValue = (enlargedCard.marketValue || marketValues[enlargedCard.id] || 1);
                    const holoMult = getHoloMultiplier(enlargedCard.id);
                    const holoValue = baseValue * holoMult;
                    const isHolo = !!enlargedCard.isHolo;

                    return (
                      <div style={{ marginBottom: 24 }}>
                        <p style={{ color: '#9ca3af', fontSize: 14, margin: '0 0 10px' }}>Market Value</p>

                        <div style={{ display: 'grid', gap: 10 }}>
                          <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', background: 'rgba(255,255,255,0.04)', border: '1px solid rgba(255,255,255,0.08)', borderRadius: 12, padding: 12 }}>
                            <div style={{ color: '#e5e7eb', fontSize: 13 }}>Non-Holo</div>
                            <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                              <img src="./rations.png" alt="R" style={{ width: 22, height: 22 }} />
                              <span style={{ color: '#fbbf24', fontSize: 22, fontWeight: 'bold' }}>{baseValue.toFixed(2)}</span>
                              
                            </div>
                          </div>

                          <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', background: 'rgba(255,255,255,0.04)', border: '1px solid rgba(255,255,255,0.08)', borderRadius: 12, padding: 12 }}>
                            <div style={{ color: '#e5e7eb', fontSize: 13 }}>
                              Holo <span style={{ color: '#9ca3af', fontSize: 12 }}>({holoMult.toFixed(2)})</span>
                            </div>
                            <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                              <img src="./rations.png" alt="R" style={{ width: 22, height: 22 }} />
                              <span className="rainbow-text" style={{ fontSize: 22, fontWeight: 'bold' }}>{holoValue.toFixed(2)}</span>
                              
                            </div>
                          </div>
                        </div>

                        {isHolo && (
                          <div style={{ marginTop: 10, fontSize: 12, color: '#d1d5db' }}>
                            <span className="holo-badge" style={{ padding: '3px 8px', borderRadius: 999, marginRight: 8 }}>HOLO</span>
                            This copy sells at the holo price.
                          </div>
                        )}

                        {enlargedCard.priceChange !== 0 && enlargedCard.priceChange !== undefined && (
                          <p style={{ 
                            color: enlargedCard.priceChange > 0 ? '#10b981' : '#ef4444', 
                            fontSize: 14, 
                            fontWeight: 'bold',
                            margin: '10px 0 0' 
                          }}>
                            {enlargedCard.priceChange > 0 ? '' : ''} {Math.abs(enlargedCard.priceChange).toFixed(2)}% vs yesterday
                          </p>
                        )}
                      </div>
                    );
                  })()}


{/* Price History Graph */}
                  {priceHistory[enlargedCard.id] && priceHistory[enlargedCard.id].length > 1 && (
                    <div>
                      <p style={{ color: '#9ca3af', fontSize: 14, margin: '0 0 12px' }}>
                        Price History (Last {Math.min(priceHistory[enlargedCard.id].length, 30)} Days)
                      </p>
                      <div style={{ background: '#1f2937', borderRadius: 8, padding: 16, height: 150, position: 'relative' }}>
                        <svg width="100%" height="100%" viewBox="0 0 300 120" preserveAspectRatio="none">
                          {(() => {
                            const history = priceHistory[enlargedCard.id].slice(-30);
                            const values = history.map(h => h.value);
                            const min = Math.min(...values) * 0.95;
                            const max = Math.max(...values) * 1.05;
                            const range = max - min;
                            
                            const points = history.map((h, i) => {
                              const x = (i / (history.length - 1)) * 300;
                              const y = 120 - ((h.value - min) / range) * 120;
                              return `${x},${y}`;
                            }).join(' ');
                            
                            return (
                              <>
                                <polyline
                                  points={points}
                                  fill="none"
                                  stroke="#10b981"
                                  strokeWidth="2"
                                />
                                {history.map((h, i) => {
                                  const x = (i / (history.length - 1)) * 300;
                                  const y = 120 - ((h.value - min) / range) * 120;
                                  return (
                                    <circle
                                      key={i}
                                      cx={x}
                                      cy={y}
                                      r="3"
                                      fill="#10b981"
                                    />
                                  );
                                })}
                              </>
                            );
                          })()}
                        </svg>
                      </div>
                      <div style={{ display: 'flex', justifyContent: 'space-between', marginTop: 8 }}>
                        <span style={{ color: '#6b7280', fontSize: 12 }}>
                          {priceHistory[enlargedCard.id][0]?.value.toFixed(2)}R
                        </span>
                        <span style={{ color: '#6b7280', fontSize: 12 }}>
                          {priceHistory[enlargedCard.id][priceHistory[enlargedCard.id].length - 1]?.value.toFixed(2)}R
                        </span>
                      </div>
                    </div>
                  )}
                  
                  <button
                    onClick={() => setEnlargedCard(null)}
                    style={{
                      width: '100%',
                      padding: '12px',
                      marginTop: 24,
                      background: '#374151',
                      color: 'white',
                      border: 'none',
                      borderRadius: 8,
                      cursor: 'pointer',
                      fontSize: 14,
                      fontWeight: 'bold'
                    }}
                  >
                    Close
                  </button>
                </div>
              </div>
            </div>
          )}
          
          
          
          

          {/* Purchase Confirmation Modal */}
          {purchaseConfirm && (
            <div
              onClick={() => setPurchaseConfirm(null)}
              style={{
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                background: 'rgba(0, 0, 0, 0.85)',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                zIndex: 1100,
                padding: 32
              }}
            >
              <div
                onClick={(e) => e.stopPropagation()}
                style={{
                  background: '#111827',
                  border: '1px solid #374151',
                  borderRadius: 16,
                  padding: 24,
                  maxWidth: 420,
                  width: '100%'
                }}
              >
                <h2 style={{ fontSize: 18, margin: '0 0 10px', textAlign: 'center' }}>
                  Confirm Purchase
                </h2>

                <div style={{
                  background: 'rgba(255,255,255,0.04)',
                  border: '1px solid rgba(255,255,255,0.08)',
                  borderRadius: 12,
                  padding: 14,
                  marginBottom: 14
                }}>
                  <div style={{ fontWeight: 'bold', marginBottom: 6 }}>
                    {purchaseConfirm.title}
                  </div>
                  {purchaseConfirm.details && (
                    <div style={{ color: '#9ca3af', fontSize: 12, lineHeight: 1.4 }}>
                      {purchaseConfirm.details}
                    </div>
                  )}
                </div>

                <div style={{
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center',
                  marginBottom: 8
                }}>
                  <div style={{ color: '#9ca3af', fontSize: 12 }}>Cost</div>
                  <div style={{ fontWeight: 'bold' }}>{purchaseConfirm.cost.toFixed(2)} R</div>
                </div>

                <div style={{
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center',
                  marginBottom: 18
                }}>
                  <div style={{ color: '#9ca3af', fontSize: 12 }}>Your balance</div>
                  <div style={{ fontWeight: 'bold' }}>{rations.toFixed(2)} R</div>
                </div>

                <div style={{ display: 'flex', gap: 12 }}>
                  <button
                    onClick={() => setPurchaseConfirm(null)}
                    style={{
                      flex: 1,
                      padding: '12px',
                      background: '#374151',
                      color: 'white',
                      border: 'none',
                      borderRadius: 8,
                      cursor: 'pointer',
                      fontSize: 14,
                      fontWeight: 'bold'
                    }}
                  >
                    Cancel
                  </button>

                  <button
                    onClick={confirmPurchase}
                    disabled={rations < purchaseConfirm.cost}
                    style={{
                      flex: 1,
                      padding: '12px',
                      background: rations < purchaseConfirm.cost ? '#1f2937' : 'linear-gradient(90deg, #3b82f6, #6366f1)',
                      color: rations < purchaseConfirm.cost ? '#6b7280' : 'white',
                      border: rations < purchaseConfirm.cost ? '1px solid rgba(255,255,255,0.10)' : 'none',
                      borderRadius: 8,
                      cursor: rations < purchaseConfirm.cost ? 'not-allowed' : 'pointer',
                      fontSize: 14,
                      fontWeight: 'bold'
                    }}
                  >
                    Confirm Purchase
                  </button>
                </div>
              </div>
            </div>
          )}
{/* Sell Confirmation Modal */}
          {sellConfirm && (() => {
            const entry = collection[sellConfirm.id] || { normal: 0, holo: 0 };
            const baseValue = getBaseMarketValue(sellConfirm.id);
            const holoMult = getHoloMultiplier(sellConfirm.id);
            const holoValue = baseValue * holoMult;
            const hasNormal = (entry.normal || 0) > 0;
            const hasHolo = (entry.holo || 0) > 0;

            return (
              <div
                onClick={() => setSellConfirm(null)}
                style={{
                  position: 'fixed',
                  top: 0,
                  left: 0,
                  right: 0,
                  bottom: 0,
                  background: 'rgba(0, 0, 0, 0.85)',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  zIndex: 1100,
                  padding: 32
                }}
              >
                <div
                  onClick={(e) => e.stopPropagation()}
                  style={{
                    background: '#111827',
                    border: '1px solid #374151',
                    borderRadius: 16,
                    padding: 24,
                    maxWidth: 420,
                    width: '100%'
                  }}
                >
                  <h2 style={{ fontSize: 18, margin: '0 0 8px', textAlign: 'center' }}>
                    Sell Card
                  </h2>

                  <div style={{ margin: '0 0 14px', textAlign: 'center' }}>
                    <div style={{ fontWeight: 'bold', marginBottom: 4 }}>{sellConfirm.name}</div>
                    <div
                      style={{
                        display: 'inline-block',
                        padding: '4px 10px',
                        borderRadius: 999,
                        background: 'rgba(255, 255, 255, 0.07)',
                        border: '1px solid rgba(255, 255, 255, 0.12)',
                        color: RARITY_COLORS[sellConfirm.rarity] || '#9ca3af',
                        fontSize: 12,
                        textTransform: 'uppercase',
                        letterSpacing: '0.08em'
                      }}
                    >
                      {sellConfirm.rarity}
                    </div>
                  </div>

                  <div style={{ display: 'flex', justifyContent: 'center', gap: 10, marginBottom: 16, flexWrap: 'wrap' }}>
                    {(entry.normal || 0) > 0 && (
                      <span style={{
                        padding: '6px 10px',
                        background: 'rgba(255,255,255,0.06)',
                        border: '1px solid rgba(255,255,255,0.12)',
                        borderRadius: 10,
                        fontSize: 12,
                        color: '#e5e7eb'
                      }}>
                        Normal: x{entry.normal || 0}
                      </span>
                    )}
                    {(entry.holo || 0) > 0 && (
                      <span className="holo-badge" style={{
                        padding: '6px 10px',
                        borderRadius: 10,
                        fontSize: 12,
                        fontWeight: 'bold'
                      }}>
                        Holo: x{entry.holo || 0}
                      </span>
                    )}
                    {(entry.normal || 0) === 0 && (entry.holo || 0) === 0 && (
                      <span style={{ color: '#9ca3af', fontSize: 12 }}>You dont own this card</span>
                    )}
                  </div>

                  <div style={{ display: 'grid', gap: 10, marginBottom: 18 }}>
                    <div style={{
                      display: 'flex',
                      justifyContent: 'space-between',
                      alignItems: 'center',
                      background: 'rgba(255,255,255,0.04)',
                      border: '1px solid rgba(255,255,255,0.08)',
                      borderRadius: 12,
                      padding: 12
                    }}>
                      <div style={{ color: '#9ca3af', fontSize: 12 }}>Normal market value</div>
                      <div style={{ fontWeight: 'bold' }}>{baseValue.toFixed(2)} R</div>
                    </div>
                    <div style={{
                      display: 'flex',
                      justifyContent: 'space-between',
                      alignItems: 'center',
                      background: 'rgba(255,255,255,0.04)',
                      border: '1px solid rgba(255,255,255,0.08)',
                      borderRadius: 12,
                      padding: 12
                    }}>
                      <div style={{ color: '#9ca3af', fontSize: 12 }}>Holo market value <span style={{ opacity: 0.8 }}>({holoMult.toFixed(2)})</span></div>
                      <div className="rainbow-text" style={{ fontWeight: 'bold' }}>{holoValue.toFixed(2)} R</div>
                    </div>
                  </div>

                  <div style={{ display: 'flex', gap: 12, flexWrap: 'wrap' }}>
                    <button
                      onClick={() => setSellConfirm(null)}
                      style={{
                        flex: 1,
                        minWidth: 110,
                        padding: '12px',
                        background: '#374151',
                        color: 'white',
                        border: 'none',
                        borderRadius: 8,
                        cursor: 'pointer',
                        fontSize: 14,
                        fontWeight: 'bold'
                      }}
                    >
                      Cancel
                    </button>

                    <button
                      onClick={() => sellNormalCard(sellConfirm.id)}
                      disabled={!hasNormal}
                      style={{
                        flex: 1,
                        minWidth: 140,
                        padding: '12px',
                        background: hasNormal ? 'linear-gradient(90deg, #10b981, #059669)' : '#1f2937',
                        color: hasNormal ? 'white' : '#6b7280',
                        border: hasNormal ? 'none' : '1px solid rgba(255,255,255,0.10)',
                        borderRadius: 8,
                        cursor: hasNormal ? 'pointer' : 'not-allowed',
                        fontSize: 14,
                        fontWeight: 'bold'
                      }}
                    >
                      Sell Normal
                    </button>

                    {hasHolo && (
                      <button
                        onClick={() => sellHoloCard(sellConfirm.id)}
                        className="holo-button"
                        style={{
                          flex: 1,
                          minWidth: 140,
                          padding: '12px',
                          borderRadius: 8,
                          cursor: 'pointer',
                          fontSize: 14,
                          fontWeight: 'bold',
                          color: 'white',
                          border: 'none'
                        }}
                      >
                        Sell Holo
                      </button>
                    )}
                  </div>
                </div>
              </div>
            );
          })()}</div>
      );
    }

    ReactDOM.render(<TCGPackOpener />, document.getElementById('root'));
  </script>
</body>
</html>
