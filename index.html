<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Through The Ages - TCG Pack Opener</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
/* Global & Reset */
html, body {
  margin: 0;
  padding: 0;
  min-height: 100%;
  background: linear-gradient(135deg, #111827 0%, #2e1065 50%, #111827 100%);
  font-family: system-ui, -apple-system, sans-serif;
  overflow-x: hidden;
  color: white;
  -webkit-tap-highlight-color: transparent;
}
#root { min-height: 100%; }

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

button, [role="button"]{
  touch-action: manipulation;
}

/* Animations */
@keyframes spin { to { transform: rotate(360deg); } }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes zoomIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
@keyframes holoSpin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
@keyframes godGlowPulse {
  0% { opacity: 0; transform: scale(0.95); }
  20% { opacity: 1; transform: scale(1.0); }
  100% { opacity: 0; transform: scale(1.05); }
}
@keyframes confettiFall {
  0% { transform: translateY(-20vh) rotate(0deg); opacity: 1; }
  100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
}

/* --- Card & Holo Visuals --- */
.card-flip {
  transition: transform 0.6s;
  transform-style: preserve-3d;
}
.card-flip.flipped {
  transform: rotateY(180deg);
}
.card-face {
  backface-visibility: hidden;
  position: absolute;
  inset: 0;
}
.card-back {
  transform: rotateY(180deg);
}

.foil-glow { position: relative; }
.foil-glow .card-face.card-back {
  position: absolute; inset: 0; overflow: hidden; isolation: isolate;
}
.foil-glow .card-face.card-back img {
  position: relative; z-index: 1; filter: saturate(1.08) contrast(1.04);
}
.foil-glow .card-face.card-back::before {
  content: ''; position: absolute; inset: 0; border-radius: inherit;
  background: linear-gradient(120deg, rgba(255,0,128,0.32), rgba(0,255,255,0.30), rgba(255,255,0,0.28), rgba(255,0,128,0.30));
  opacity: 0.42; filter: saturate(1.5) contrast(1.08); pointer-events: none; z-index: 3; mix-blend-mode: overlay;
}
.foil-glow .card-face.card-back::after {
  content: ''; position: absolute; inset: 0; border-radius: inherit;
  background: radial-gradient(circle at 30% 20%, rgba(255,255,255,0.22), rgba(255,255,255,0.0) 55%);
  opacity: 0.20; pointer-events: none; z-index: 4;
}

.holo-badge {
  background: linear-gradient(90deg, rgba(255,0,128,0.40), rgba(0,255,255,0.40), rgba(255,255,0,0.40));
  box-shadow: 0 0 18px rgba(255,255,255,0.15);
  color: rgba(255,255,255,0.98);
  text-shadow: 0 1px 2px rgba(0,0,0,0.85);
}
.rainbow-text {
  background: linear-gradient(90deg, #ff3ea5, #2ee9ff, #ffe155, #ff3ea5);
  -webkit-background-clip: text; background-clip: text; color: transparent;
  filter: drop-shadow(0 0 10px rgba(255,255,255,0.20));
}
.holo-button {
  background: linear-gradient(90deg, #ff3ea5, #2ee9ff, #ffe155, #ff3ea5);
  box-shadow: 0 0 18px rgba(255,255,255,0.18);
  border: none;
}

/* --- God Pack & Modals --- */
.godpack-effect { position: fixed; inset: 0; pointer-events: none; z-index: 2500; overflow: hidden; }
.godpack-effect::before {
  content: ''; position: absolute; inset: -20%;
  background: radial-gradient(circle at 50% 40%, rgba(255,255,255,0.28), rgba(168,85,247,0.12) 40%, rgba(0,0,0,0) 72%);
  mix-blend-mode: screen; animation: godGlowPulse 1.6s ease-out forwards;
}
.confetti-piece {
  position: absolute; top: -12vh; width: var(--w); height: var(--h); left: var(--left);
  background: var(--c); border-radius: 2px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.35));
  animation: confettiFall var(--dur) linear forwards; animation-delay: var(--delay); opacity: 0.95;
}
.godpack-gate {
  position: fixed; inset: 0; z-index: 3200; display: flex; align-items: center; justify-content: center;
  background: rgba(0,0,0,0.72); backdrop-filter: blur(6px);
}
.godpack-gate-card {
  width: min(560px, 92vw); border-radius: 18px; padding: 24px;
  border: 1px solid rgba(255,255,255,0.14); background: rgba(17,24,39,0.92);
  box-shadow: 0 30px 90px rgba(0,0,0,0.55); position: relative; overflow: hidden; text-align: center;
}

.modal-overlay {
  position: fixed; inset: 0; background: rgba(0, 0, 0, 0.85);
  display: flex; align-items: center; justify-content: center; z-index: 1000;
  cursor: pointer; animation: fadeIn 0.2s;
}
.modal { background: #1f2937; padding: 20px; border-radius: 12px; cursor: default; }

/* --- Mobile Nav --- */
.hamburger-btn { display: none; }
.menu-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.35); z-index: 200; }
.menu-panel {
  position: fixed; top: 66px; right: 12px; width: min(340px, calc(100vw - 24px));
  background: rgba(17,24,39,0.96); border: 1px solid rgba(255,255,255,0.12);
  border-radius: 16px; padding: 10px; z-index: 201;
  box-shadow: 0 24px 70px rgba(0,0,0,0.55); backdrop-filter: blur(10px);
}
@media (max-width: 720px) {
  .topbar-nav { display: none !important; }
  .hamburger-btn { display: inline-flex !important; align-items: center; justify-content: center; }
  .topbar-title { font-size: 18px !important; }
  .topbar { padding: 10px 12px !important; }
}

/* --- New Stack / Peek Styles --- */
.stack-container {
  position: relative;
  width: 100%;
  height: 440px;
  display: flex;
  justify-content: center;
  align-items: center;
  perspective: 1000px;
  margin-bottom: 20px;
  z-index: 10;
}
.stack-card {
  position: absolute;
  width: 240px;
  aspect-ratio: 2.5/3.5;
  border-radius: 14px;
  transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
  box-shadow: 0 10px 30px rgba(0,0,0,0.5);
  cursor: pointer;
  transform-origin: center bottom;
  background: #1f2937;
  overflow: hidden;
}
.stack-card:hover {
  transform: translateY(-10px);
}
/* When peeking, shift cards */
.peeking .stack-card {
  box-shadow: -5px 0 15px rgba(0,0,0,0.3);
}

.reveal-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
  gap: 8px;
  margin-top: 20px;
  opacity: 0.9;
}
</style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useCallback, useMemo, useRef } = React;

    const GITHUB_BASE = '.';

    // All 391 cards (Data unchanged)
    const ALL_CARDS = [
      { id: "1", name: "A Big Stick", rarity: "common", file: "A Big Stick.png" },
      { id: "2", name: "A Chill on the Wind", rarity: "uncommon", file: "A Chill on the Wind.png" },
      { id: "3", name: "Adaptability", rarity: "common", file: "Adaptability.png" },
      { id: "4", name: "Adrias", rarity: "legendary", file: "Adrias.png" },
      { id: "5", name: "All Eyes On You", rarity: "common", file: "All Eyes On You.png" },
      { id: "6", name: "All In", rarity: "rare", file: "All In.png" },
      { id: "7", name: "Animal Experiments", rarity: "rare", file: "Animal Experiments.png" },
      { id: "8", name: "Ante Up", rarity: "common", file: "Ante Up.png" },
      { id: "9", name: "Arbeleatrier", rarity: "common", file: "Arbeleatrier.png" },
      { id: "10", name: "Archer Legion", rarity: "common", file: "Archer Legion.png" },
      { id: "11", name: "Archer's Greaves", rarity: "common", file: "Archer's Greaves.png" },
      { id: "12", name: "Armistice", rarity: "uncommon", file: "Armistice.png" },
      { id: "13", name: "Armor Fitter Herc", rarity: "common", file: "Armor Fitter Herc.png" },
      { id: "14", name: "Armored Elephants", rarity: "common", file: "Armored Elephants.png" },
      { id: "15", name: "Assassinate", rarity: "rare", file: "Assassinate.png" },
      { id: "16", name: "Attempt at Re-Creation", rarity: "rare", file: "Attempt at Re-Creation.png" },
      { id: "17", name: "Azure Guard", rarity: "common", file: "Azure Guard.png" },
      { id: "18", name: "Azure, Star Seeker", rarity: "rare", file: "Azure, Star Seeker.png" },
      { id: "19", name: "Azure's Assistant", rarity: "common", file: "Azure's Assistant.png" },
      { id: "20", name: "Azure's Backup", rarity: "common", file: "Azure's Backup.png" },
      { id: "21", name: "Azure's Feral Cats", rarity: "common", file: "Azure's Feral Cats.png" },
      { id: "22", name: "Azure's Razor, Opus Dei", rarity: "legendary", file: "Azure's Razor, Opus Dei.png" },
      { id: "23", name: "Azure's Razor, Opus Dei X", rarity: "ultra x rare", file: "Azure's Razor, Opus Dei X.png" },
      { id: "24", name: "Azure's Stars Aligned", rarity: "rare", file: "Azure's Stars Aligned.png" },
      { id: "25", name: "Azure's Stars Aligned X", rarity: "ultra x rare", file: "Azure's Stars Aligned X.png" },
      { id: "26", name: "Banner of Death", rarity: "uncommon", file: "Banner of Death.png" },
      { id: "27", name: "Banner of Pride", rarity: "uncommon", file: "Banner of Pride.png" },
      { id: "28", name: "Banner of Unity", rarity: "rare", file: "Banner of Unity.png" },
      { id: "29", name: "Banner of War", rarity: "uncommon", file: "Banner of War.png" },
      { id: "30", name: "Barbaric Shout", rarity: "uncommon", file: "Barbaric Shout.png" },
      { id: "31", name: "Basterd of Blades", rarity: "common", file: "Basterd of Blades.png" },
      { id: "32", name: "Battle of Champions", rarity: "rare", file: "Battle of Champions.png" },
      { id: "33", name: "Battle Owl", rarity: "uncommon", file: "Battle Owl.png" },
      { id: "34", name: "Beard Tokens", rarity: "uncommon", file: "Beard Tokens.png" },
      { id: "35", name: "Beastly Leather Gown", rarity: "uncommon", file: "Beastly Leather Gown.png" },
      { id: "36", name: "Behind Enemy Lines", rarity: "common", file: "Behind Enemy Lines.png" },
      { id: "37", name: "Belt of the Bold", rarity: "common", file: "Belt of the Bold.png" },
      { id: "38", name: "Benne, Indric's Only Friend", rarity: "common", file: "Benne, Indric's Only Friend.png" },
      { id: "39", name: "Berserker Mushroom", rarity: "common", file: "Berserker Mushroom.png" },
      { id: "40", name: "Biting Bats", rarity: "common", file: "Biting Bats.png" },
      { id: "41", name: "Blacksmith's Daughter", rarity: "uncommon", file: "Blacksmith's Daughter.png" },
      { id: "42", name: "Blade of Beginnings", rarity: "legendary", file: "Blade of Beginnings.png" },
      { id: "43", name: "Blade Sharpener Ansil", rarity: "uncommon", file: "Blade Sharpener Ansil.png" },
      { id: "44", name: "Blade-Winged Eagles", rarity: "uncommon", file: "Blade-Winged Eagles.png" },
      { id: "45", name: "Blinded Jalio, the One Who Takes", rarity: "common", file: "Blinded Jalio, the One Who Takes.png" },
      { id: "46", name: "Blizzerd", rarity: "common", file: "Blizzerd.png" },
      { id: "47", name: "Bloodlust", rarity: "common", file: "Bloodlust.png" },
      { id: "48", name: "Bloodmorn", rarity: "uncommon", file: "Bloodmorn.png" },
      { id: "49", name: "Bloodthirsty Mice", rarity: "common", file: "Bloodthirsty Mice.png" },
      { id: "50", name: "Bloody Bear", rarity: "common", file: "Bloody Bear.png" },
      { id: "51", name: "Bloody Scream", rarity: "uncommon", file: "Bloody Scream.png" },
      { id: "52", name: "Bluff", rarity: "common", file: "Bluff.png" },
      { id: "53", name: "Bonfire", rarity: "rare", file: "Bonfire.png" },
      { id: "54", name: "Bookkeeper Terrin", rarity: "uncommon", file: "Bookkeeper Terrin.png" },
      { id: "55", name: "Bounty Collectors", rarity: "common", file: "Bounty Collectors.png" },
      { id: "56", name: "Breaker Captain", rarity: "common", file: "Breaker Captain.png" },
      { id: "57", name: "Breaker Guard", rarity: "common", file: "Breaker Guard.png" },
      { id: "58", name: "Breaker's Focus", rarity: "common", file: "Breaker's Focus.png" },
      { id: "59", name: "Brew of the Dawn", rarity: "uncommon", file: "Brew of the Dawn.png" },
      { id: "60", name: "Bribe the Guards", rarity: "common", file: "Bribe the Guards.png" },
      { id: "61", name: "Burn the Tents", rarity: "uncommon", file: "Burn the Tents.png" },
      { id: "62", name: "Burned Into Memory", rarity: "common", file: "Burned Into Memory.png" },
      { id: "63", name: "Burning Soul", rarity: "uncommon", file: "Burning Soul.png" },
      { id: "64", name: "Call of Beasts", rarity: "uncommon", file: "Call of Beasts.png" },
      { id: "65", name: "Called It", rarity: "uncommon", file: "Called It.png" },
      { id: "66", name: "Cascade of Darkness", rarity: "common", file: "Cascade of Darkness.png" },
      { id: "67", name: "Castle Walls", rarity: "uncommon", file: "Castle Walls.png" },
      { id: "68", name: "Cerberus", rarity: "legendary", file: "Cerberus.png" },
      { id: "69", name: "Chain of the Gravetender", rarity: "rare", file: "Chain of the Gravetender.png" },
      { id: "70", name: "Chainmail Hood", rarity: "uncommon", file: "Chainmail Hood.png" },
      { id: "71", name: "Chalice of God", rarity: "uncommon", file: "Chalice of God.png" },
      { id: "72", name: "Change of the Seasons", rarity: "common", file: "Change of the Seasons.png" },
      { id: "73", name: "Charge", rarity: "legendary", file: "Charge.png" },
      { id: "74", name: "Chivalry", rarity: "uncommon", file: "Chivalry.png" },
      { id: "75", name: "Cleric", rarity: "rare", file: "Cleric.png" },
      { id: "76", name: "Combusting Mushroom", rarity: "common", file: "Combusting Mushroom.png" },
      { id: "77", name: "Commander Hew's Helm of Command", rarity: "uncommon", file: "Commander Hew's Helm of Command.png" },
      { id: "78", name: "Commander's Decree", rarity: "uncommon", file: "Commander's Decree.png" },
      { id: "79", name: "Cooked in Armor", rarity: "uncommon", file: "Cooked in Armor.png" },
      { id: "80", name: "Counterintelligence", rarity: "uncommon", file: "Counterintelligence.png" },
      { id: "81", name: "Crowspies", rarity: "uncommon", file: "Crowspies.png" },
      { id: "82", name: "Cultists", rarity: "uncommon", file: "Cultists.png" },
      { id: "83", name: "De'vone Matria", rarity: "common", file: "De'vone Matria.png" },
      { id: "84", name: "Death Becomes", rarity: "uncommon", file: "Death Becomes.png" },
      { id: "85", name: "Death Enough", rarity: "uncommon", file: "Death Enough.png" },
      { id: "86", name: "Death Forgets", rarity: "uncommon", file: "Death Forgets.png" },
      { id: "87", name: "Death Forgives", rarity: "uncommon", file: "Death Forgives.png" },
      { id: "88", name: "Death Indeed", rarity: "uncommon", file: "Death Indeed.png" },
      { id: "89", name: "Death Mushroom", rarity: "common", file: "Death Mushroom.png" },
      { id: "90", name: "Death Remembers", rarity: "uncommon", file: "Death Remembers.png" },
      { id: "91", name: "Defel, The Rain", rarity: "uncommon", file: "Defel, The Rain.png" },
      { id: "92", name: "Demense", rarity: "uncommon", file: "Demense.png" },
      { id: "93", name: "Deranged Prisoners", rarity: "common", file: "Deranged Prisoners.png" },
      { id: "94", name: "Diorys Gianpetro", rarity: "rare", file: "Diorys Gianpetro.png" },
      { id: "95", name: "Directionless", rarity: "common", file: "Directionless.png" },
      { id: "96", name: "Dishonorable Discharge", rarity: "common", file: "Dishonorable Discharge.png" },
      { id: "97", name: "Distortion Curse", rarity: "uncommon", file: "Distortion Curse.png" },
      { id: "98", name: "Divination Scribe", rarity: "common", file: "Divination Scribe.png" },
      { id: "99", name: "Divine Intervention", rarity: "legendary", file: "Divine Intervention.png" },
      { id: "100", name: "Double Down", rarity: "rare", file: "Double Down.png" },
      { id: "101", name: "Double Up", rarity: "common", file: "Double Up.png" },
      { id: "102", name: "Draft the Recruits", rarity: "rare", file: "Draft the Recruits.png" },
      { id: "103", name: "Dragonslayer", rarity: "rare", file: "Dragonslayer.png" },
      { id: "104", name: "Draught", rarity: "common", file: "Draught.png" },
      { id: "105", name: "Droves of Wolves", rarity: "common", file: "Droves of Wolves.png" },
      { id: "106", name: "Duray, Pickpocket", rarity: "common", file: "Duray, Pickpocket.png" },
      { id: "107", name: "Eat Up", rarity: "common", file: "Eat Up.png" },
      { id: "108", name: "Embolden", rarity: "common", file: "Embolden.png" },
      { id: "109", name: "Endless Knives", rarity: "rare", file: "Endless Knives.png" },
      { id: "110", name: "Enough!", rarity: "common", file: "Enough!.png" },
      { id: "111", name: "Ethical Soldier", rarity: "uncommon", file: "Ethical Soldier.png" },
      { id: "112", name: "Expensive Armor", rarity: "common", file: "Expensive Armor.png" },
      { id: "113", name: "Exploding Rats", rarity: "common", file: "Exploding Rats.png" },
      { id: "114", name: "Extortion", rarity: "common", file: "Extortion.png" },
      { id: "115", name: "Eye of Pride", rarity: "common", file: "Eye of Pride.png" },
      { id: "116", name: "Failed Insurrection", rarity: "rare", file: "Failed Insurrection.png" },
      { id: "117", name: "Fattened Battle Cattle", rarity: "common", file: "Fattened Battle Cattle.png" },
      { id: "118", name: "Fatty Gunni", rarity: "common", file: "Fatty Gunni.png" },
      { id: "119", name: "Feral Cats", rarity: "common", file: "Feral Cats.png" },
      { id: "120", name: "Field of Blood", rarity: "common", file: "Field of Blood.png" },
      { id: "121", name: "Final Charge", rarity: "uncommon", file: "Final Charge.png" },
      { id: "122", name: "Fire Arrows", rarity: "common", file: "Fire Arrows.png" },
      { id: "123", name: "Fisherman Yimoti", rarity: "common", file: "Fisherman Yimoti.png" },
      { id: "124", name: "Fixed Result", rarity: "common", file: "Fixed Result.png" },
      { id: "125", name: "Flute Player's Anthem", rarity: "uncommon", file: "Flute Player's Anthem.png" },
      { id: "126", name: "Foggy Hills", rarity: "common", file: "Foggy Hills.png" },
      { id: "127", name: "Foggy Morning", rarity: "rare", file: "Foggy Morning.png" },
      { id: "128", name: "Forged Vambraces", rarity: "common", file: "Forged Vambraces.png" },
      { id: "129", name: "Forgotten By the Future", rarity: "uncommon", file: "Forgotten By the Future.png" },
      { id: "130", name: "Fresh Drinking Water", rarity: "rare", file: "Fresh Drinking Water.png" },
      { id: "131", name: "Full Belly Ceddir", rarity: "common", file: "Full Belly Ceddir.png" },
      { id: "132", name: "General Azure", rarity: "rare", file: "General Azure.png" },
      { id: "133", name: "General's Bounty", rarity: "uncommon", file: "General's Bounty.png" },
      { id: "134", name: "General's Command", rarity: "common", file: "General's Command.png" },
      { id: "135", name: "Getaway Steeds", rarity: "uncommon", file: "Getaway Steeds.png" },
      { id: "136", name: "Give Ground", rarity: "common", file: "Give Ground.png" },
      { id: "137", name: "Golden Knight Captain", rarity: "uncommon", file: "Golden Knight Captain.png" },
      { id: "138", name: "Golden Knight Leader Lorren", rarity: "uncommon", file: "Golden Knight Leader Lorren.png" },
      { id: "139", name: "Golden Ymra", rarity: "rare", file: "Golden Ymra.png" },
      { id: "140", name: "Golden Ymra X", rarity: "ultra x rare", file: "Golden Ymra X.png" },
      { id: "141", name: "Grand Researcher Udolvis", rarity: "uncommon", file: "Grand Researcher Udolvis.png" },
      { id: "142", name: "Grandfather Pine", rarity: "uncommon", file: "Grandfather Pine.png" },
      { id: "143", name: "Gravetender's Shovel", rarity: "uncommon", file: "Gravetender's Shovel.png" },
      { id: "144", name: "Greatwall Yvera", rarity: "uncommon", file: "Greatwall Yvera.png" },
      { id: "145", name: "Greselia, Worldhopper", rarity: "uncommon", file: "Greselia, Worldhopper.png" },
      { id: "146", name: "Grew Up Together", rarity: "common", file: "Grew Up Together.png" },
      { id: "147", name: "Group of Corrupts", rarity: "common", file: "Group of Corrupts.png" },
      { id: "148", name: "Grozu", rarity: "common", file: "Grozu.png" },
      { id: "149", name: "Guttermite Drinny", rarity: "common", file: "Guttermite Drinny.png" },
      { id: "150", name: "Handwraps", rarity: "common", file: "Handwraps.png" },
      { id: "151", name: "Helm of Time", rarity: "rare", file: "Helm of Time.png" },
      { id: "152", name: "Hide", rarity: "uncommon", file: "Hide.png" },
      { id: "153", name: "High Morale", rarity: "rare", file: "High Morale.png" },
      { id: "154", name: "Honorable Discharge", rarity: "common", file: "Honorable Discharge.png" },
      { id: "155", name: "Hornman Thut", rarity: "common", file: "Hornman Thut.png" },
      { id: "156", name: "Houndmaster Bretta", rarity: "rare", file: "Houndmaster Bretta.png" },
      { id: "157", name: "Human Test Subject", rarity: "uncommon", file: "Human Test Subject.png" },
      { id: "158", name: "Hungover Golden Knights", rarity: "common", file: "Hungover Golden Knights.png" },
      { id: "159", name: "Huntsman Brekka", rarity: "common", file: "Huntsman Brekka.png" },
      { id: "160", name: "Hurd and Grozu", rarity: "common", file: "Hurd and Grozu.png" },
      { id: "161", name: "Ignorant Foresh", rarity: "common", file: "Ignorant Foresh.png" },
      { id: "162", name: "In the Shade of the Trees", rarity: "rare", file: "In the Shade of the Trees.png" },
      { id: "163", name: "Indric Puratta, the World is His", rarity: "rare", file: "Indric Puratta, the World is His.png" },
      { id: "164", name: "Indric Puratta, The World Is His X", rarity: "ultra x rare", file: "Indric Puratta, The World Is His X.png" },
      { id: "165", name: "Injection of Funds", rarity: "uncommon", file: "Injection of Funds.png" },
      { id: "166", name: "Intersection of Past and Future", rarity: "common", file: "Intersection of Past and Future.png" },
      { id: "167", name: "Intimidation", rarity: "rare", file: "Intimidation.png" },
      { id: "168", name: "Jacques", rarity: "rare", file: "Jacques.png" },
      { id: "169", name: "Jailbreak", rarity: "common", file: "Jailbreak.png" },
      { id: "170", name: "Journey to the Otherside", rarity: "common", file: "Journey to the Otherside.png" },
      { id: "171", name: "Keep the Family Close", rarity: "rare", file: "Keep the Family Close.png" },
      { id: "172", name: "King's Favor", rarity: "uncommon", file: "King's Favor.png" },
      { id: "173", name: "Kingkiller Vodd", rarity: "rare", file: "Kingkiller Vodd.png" },
      { id: "174", name: "Knife Maiden", rarity: "common", file: "Knife Maiden.png" },
      { id: "175", name: "Landshark", rarity: "common", file: "Landshark.png" },
      { id: "176", name: "Latrine Diggers", rarity: "common", file: "Latrine Diggers.png" },
      { id: "177", name: "Lead Astray", rarity: "uncommon", file: "Lead Astray.png" },
      { id: "178", name: "Leader of the Maggots", rarity: "common", file: "Leader of the Maggots.png" },
      { id: "179", name: "Leather Coat", rarity: "uncommon", file: "Leather Coat.png" },
      { id: "180", name: "Lectio Divinia", rarity: "legendary", file: "Lectio Divinia.png" },
      { id: "181", name: "Letters to the Future", rarity: "rare", file: "Letters to the Future.png" },
      { id: "182", name: "Lost Company", rarity: "common", file: "Lost Company.png" },
      { id: "183", name: "Loyal Hounds", rarity: "common", file: "Loyal Hounds.png" },
      { id: "184", name: "Lupin, Young Royal", rarity: "common", file: "Lupin, Young Royal.png" },
      { id: "185", name: "Marching On", rarity: "common", file: "Marching On.png" },
      { id: "186", name: "Marshland", rarity: "common", file: "Marshland.png" },
      { id: "187", name: "Master Assassin", rarity: "uncommon", file: "Master Assassin.png" },
      { id: "188", name: "Midnight Concoction", rarity: "uncommon", file: "Midnight Concoction.png" },
      { id: "189", name: "Mink, Jester of Kings", rarity: "uncommon", file: "Mink, Jester of Kings.png" },
      { id: "190", name: "Misplaced Treasure", rarity: "rare", file: "Misplaced Treasure.png" },
      { id: "191", name: "Moldy Bread", rarity: "common", file: "Moldy Bread.png" },
      { id: "192", name: "More Than Enough", rarity: "uncommon", file: "More Than Enough.png" },
      { id: "193", name: "Mouth of Hate", rarity: "uncommon", file: "Mouth of Hate.png" },
      { id: "194", name: "Mundane Murderer", rarity: "common", file: "Mundane Murderer.png" },
      { id: "195", name: "Mushroom Feaster", rarity: "common", file: "Mushroom Feaster.png" },
      { id: "196", name: "Necrokane", rarity: "common", file: "Necrokane.png" },
      { id: "197", name: "Nightfall", rarity: "legendary", file: "Nightfall.png" },
      { id: "198", name: "Nightretch Assassins", rarity: "uncommon", file: "Nightretch Assassins.png" },
      { id: "199", name: "No Soldier Goes Unpaid", rarity: "uncommon", file: "No Soldier Goes Unpaid.png" },
      { id: "200", name: "Not Enough to Drink", rarity: "common", file: "Not Enough to Drink.png" },
      { id: "201", name: "Not So Well Thought Plan", rarity: "common", file: "Not So Well Thought Plan.png" },
      { id: "202", name: "Not Today, Soldier!", rarity: "uncommon", file: "Not Today, Soldier!.png" },
      { id: "203", name: "Nothing Left", rarity: "rare", file: "Nothing Left.png" },
      { id: "204", name: "Old Man Sigra", rarity: "uncommon", file: "Old Man Sigra.png" },
      { id: "205", name: "Oracle", rarity: "uncommon", file: "Oracle.png" },
      { id: "206", name: "Overworked Bookkeeper", rarity: "common", file: "Overworked Bookkeeper.png" },
      { id: "207", name: "Pack of Hounds", rarity: "common", file: "Pack of Hounds.png" },
      { id: "208", name: "Page Idica", rarity: "uncommon", file: "Page Idica.png" },
      { id: "209", name: "Page of Hands", rarity: "uncommon", file: "Page of Hands.png" },
      { id: "210", name: "Page Yus", rarity: "uncommon", file: "Page Yus.png" },
      { id: "211", name: "Paid Off", rarity: "common", file: "Paid Off.png" },
      { id: "212", name: "Parade", rarity: "common", file: "Parade.png" },
      { id: "213", name: "Parley", rarity: "common", file: "Parley.png" },
      { id: "214", name: "Pay Up", rarity: "common", file: "Pay Up.png" },
      { id: "215", name: "Penny Pincher", rarity: "uncommon", file: "Penny Pincher.png" },
      { id: "216", name: "Pickpocket", rarity: "common", file: "Pickpocket.png" },
      { id: "217", name: "Place the Order", rarity: "common", file: "Place the Order.png" },
      { id: "218", name: "Plague of Rats", rarity: "common", file: "Plague of Rats.png" },
      { id: "219", name: "Plan", rarity: "common", file: "Plan.png" },
      { id: "220", name: "Plate of Night", rarity: "uncommon", file: "Plate of Night.png" },
      { id: "221", name: "Porous Ducts", rarity: "common", file: "Porous Ducts.png" },
      { id: "222", name: "Prayer", rarity: "common", file: "Prayer.png" },
      { id: "223", name: "Prayer of Winds", rarity: "uncommon", file: "Prayer of Winds.png" },
      { id: "224", name: "Premeditated", rarity: "uncommon", file: "Premeditated.png" },
      { id: "225", name: "Prepare to Strike", rarity: "uncommon", file: "Prepare to Strike.png" },
      { id: "226", name: "Promising Recruit", rarity: "common", file: "Promising Recruit.png" },
      { id: "227", name: "Prophecy", rarity: "common", file: "Prophecy.png" },
      { id: "228", name: "Protectorate Genus", rarity: "common", file: "Protectorate Genus.png" },
      { id: "229", name: "Protectorate Leader of All", rarity: "uncommon", file: "Protectorate Leader of All.png" },
      { id: "230", name: "Proud Soldiers", rarity: "common", file: "Proud Soldiers.png" },
      { id: "231", name: "Puratta's Broadsword, Blessed Blade", rarity: "legendary", file: "Puratta's Broadsword, Blessed Blade.png" },
      { id: "232", name: "Puratta's Broadsword, Blessed Blade X", rarity: "ultra x rare", file: "Puratta's Broadsword, Blessed Blade X.png" },
      { id: "233", name: "Puratta's Oath", rarity: "common", file: "Puratta's Oath.png" },
      { id: "234", name: "Putyr, Viero, and Shara Vallobranch", rarity: "rare", file: "Putyr, Viero, and Shara Vallobranch.png" },
      { id: "235", name: "Putyr's Favorite Charger", rarity: "common", file: "Putyr's Favorite Charger.png" },
      { id: "236", name: "Quake", rarity: "legendary", file: "Quake.png" },
      { id: "237", name: "Quartermaster Bergana", rarity: "rare", file: "Quartermaster Bergana.png" },
      { id: "238", name: "Queens Command", rarity: "uncommon", file: "Queens Command.png" },
      { id: "239", name: "Quick Grab", rarity: "uncommon", file: "Quick Grab.png" },
      { id: "240", name: "Rampaging Demigod Vodd", rarity: "rare", file: "Rampaging Demigod Vodd.png" },
      { id: "241", name: "Rampaging Demigod Vodd X", rarity: "ultra x rare", file: "Rampaging Demigod Vodd X.png" },
      { id: "242", name: "Ready Or Not", rarity: "uncommon", file: "Ready Or Not.png" },
      { id: "243", name: "Reborn Rabbit", rarity: "common", file: "Reborn Rabbit.png" },
      { id: "244", name: "Recco", rarity: "rare", file: "Recco.png" },
      { id: "245", name: "Recco Demonblood", rarity: "rare", file: "Recco Demonblood.png" },
      { id: "246", name: "Recco, Plane of Hate", rarity: "legendary", file: "Recco, Plane of Hate.png" },
      { id: "247", name: "Regroup", rarity: "common", file: "Regroup.png" },
      { id: "248", name: "Researcher Pilio", rarity: "common", file: "Researcher Pilio.png" },
      { id: "249", name: "Researcher Recruit", rarity: "common", file: "Researcher Recruit.png" },
      { id: "250", name: "Retreat", rarity: "common", file: "Retreat.png" },
      { id: "251", name: "Rew, the Butcher", rarity: "uncommon", file: "Rew, the Butcher.png" },
      { id: "252", name: "Ritual Maiden Ferlindie", rarity: "uncommon", file: "Ritual Maiden Ferlindie.png" },
      { id: "253", name: "Roques", rarity: "legendary", file: "Roques.png" },
      { id: "254", name: "Royal Palace", rarity: "common", file: "Royal Palace.png" },
      { id: "255", name: "Rupert, Flag Bearer", rarity: "uncommon", file: "Rupert, Flag Bearer.png" },
      { id: "256", name: "Rusty Sword", rarity: "common", file: "Rusty Sword.png" },
      { id: "257", name: "Sacrificial Boars", rarity: "uncommon", file: "Sacrificial Boars.png" },
      { id: "258", name: "Sadistic Wretch", rarity: "common", file: "Sadistic Wretch.png" },
      { id: "259", name: "Salla Salvato, Disguise Master", rarity: "common", file: "Salla Salvato, Disguise Master.png" },
      { id: "260", name: "Salutations", rarity: "common", file: "Salutations.png" },
      { id: "261", name: "Scars of a General's Past", rarity: "rare", file: "Scars of a General's Past.png" },
      { id: "262", name: "See it in the Bones", rarity: "common", file: "See it in the Bones.png" },
      { id: "263", name: "Send in the Ladies", rarity: "uncommon", file: "Send in the Ladies.png" },
      { id: "264", name: "Ser Banyon", rarity: "common", file: "Ser Banyon.png" },
      { id: "265", name: "Ser Geren, Knight of the King", rarity: "uncommon", file: "Ser Geren, Knight of the King.png" },
      { id: "266", name: "Ser Indric", rarity: "rare", file: "Ser Indric.png" },
      { id: "267", name: "Ser Indric's Victory", rarity: "rare", file: "Ser Indric's Victory.png" },
      { id: "268", name: "Sewers", rarity: "common", file: "Sewers.png" },
      { id: "269", name: "Shamed Royal", rarity: "common", file: "Shamed Royal.png" },
      { id: "270", name: "Shara, The Lone Branch", rarity: "rare", file: "Shara, The Lone Branch.png" },
      { id: "271", name: "Shara, The Lone Branch X", rarity: "ultra x rare", file: "Shara, The Lone Branch X.png" },
      { id: "272", name: "Sharpened Blade", rarity: "uncommon", file: "Sharpened Blade.png" },
      { id: "273", name: "Siege Weapons", rarity: "rare", file: "Siege Weapons.png" },
      { id: "274", name: "Sister Wressa", rarity: "common", file: "Sister Wressa.png" },
      { id: "275", name: "Sister Wrinna", rarity: "common", file: "Sister Wrinna.png" },
      { id: "276", name: "Sleep Mushroom", rarity: "common", file: "Sleep Mushroom.png" },
      { id: "277", name: "Slingshot", rarity: "common", file: "Slingshot.png" },
      { id: "278", name: "Snake Under the Sheets", rarity: "common", file: "Snake Under the Sheets.png" },
      { id: "279", name: "Snakeskin Assassin", rarity: "uncommon", file: "Snakeskin Assassin.png" },
      { id: "280", name: "Son of Arvada, Personal Guard", rarity: "common", file: "Son of Arvada, Personal Guard.png" },
      { id: "281", name: "Soulcloud", rarity: "common", file: "Soulcloud.png" },
      { id: "282", name: "Speak with Animals", rarity: "common", file: "Speak with Animals.png" },
      { id: "283", name: "Split Open", rarity: "common", file: "Split Open.png" },
      { id: "284", name: "Spotter", rarity: "common", file: "Spotter.png" },
      { id: "285", name: "Sprout Horns", rarity: "common", file: "Sprout Horns.png" },
      { id: "286", name: "Spyglass", rarity: "uncommon", file: "Spyglass.png" },
      { id: "287", name: "Spymaster Droxy", rarity: "rare", file: "Spymaster Droxy.png" },
      { id: "288", name: "Squire Moveux", rarity: "common", file: "Squire Moveux.png" },
      { id: "289", name: "Staff of the Beast", rarity: "common", file: "Staff of the Beast.png" },
      { id: "290", name: "Starlight", rarity: "legendary", file: "Starlight.png" },
      { id: "291", name: "Stash House", rarity: "common", file: "Stash House.png" },
      { id: "292", name: "Steady!", rarity: "common", file: "Steady!.png" },
      { id: "293", name: "Stigmata", rarity: "uncommon", file: "Stigmata.png" },
      { id: "294", name: "Stone Mushroom", rarity: "common", file: "Stone Mushroom.png" },
      { id: "295", name: "Stored for Later", rarity: "common", file: "Stored for Later.png" },
      { id: "296", name: "Sturdy Leather Boots", rarity: "common", file: "Sturdy Leather Boots.png" },
      { id: "297", name: "Sturdy Phalanx", rarity: "uncommon", file: "Sturdy Phalanx.png" },
      { id: "298", name: "Summoner Aslye", rarity: "uncommon", file: "Summoner Aslye.png" },
      { id: "299", name: "Sunrise", rarity: "legendary", file: "Sunrise.png" },
      { id: "300", name: "Sunset", rarity: "common", file: "Sunset.png" },
      { id: "301", name: "Supplies", rarity: "common", file: "Supplies.png" },
      { id: "302", name: "Supply Line Cutoff", rarity: "uncommon", file: "Supply Line Cutoff.png" },
      { id: "303", name: "Sweat", rarity: "common", file: "Sweat.png" },
      { id: "304", name: "Tales of Yternus", rarity: "uncommon", file: "Tales of Yternus.png" },
      { id: "305", name: "Tears of God", rarity: "legendary", file: "Tears of God.png" },
      { id: "306", name: "Temporary Encampment", rarity: "rare", file: "Temporary Encampment.png" },
      { id: "307", name: "Tempted Traitor", rarity: "uncommon", file: "Tempted Traitor.png" },
      { id: "308", name: "Tent Maiden", rarity: "common", file: "Tent Maiden.png" },
      { id: "309", name: "Teserio the Mage", rarity: "common", file: "Teserio the Mage.png" },
      { id: "310", name: "The Bonfire", rarity: "common", file: "The Bonfire.png" },
      { id: "311", name: "The Burning Pile", rarity: "common", file: "The Burning Pile.png" },
      { id: "312", name: "The Castle", rarity: "common", file: "The Castle.png" },
      { id: "313", name: "The Core", rarity: "rare", file: "The Core.png" },
      { id: "314", name: "The Creator's Star", rarity: "rare", file: "The Creator's Star.png" },
      { id: "315", name: "The Fixer", rarity: "uncommon", file: "The Fixer.png" },
      { id: "316", name: "The Forgotten Branch", rarity: "rare", file: "The Forgotten Branch.png" },
      { id: "317", name: "The Funeral", rarity: "rare", file: "The Funeral.png" },
      { id: "318", name: "The House", rarity: "rare", file: "The House.png" },
      { id: "319", name: "The House Always Wins", rarity: "common", file: "The House Always Wins.png" },
      { id: "320", name: "The Influence", rarity: "rare", file: "The Influence.png" },
      { id: "321", name: "The Knights Creed", rarity: "common", file: "The Knights Creed.png" },
      { id: "322", name: "The Laughing Knight", rarity: "common", file: "The Laughing Knight.png" },
      { id: "323", name: "The Lie", rarity: "rare", file: "The Lie.png" },
      { id: "324", name: "The Negotiator", rarity: "uncommon", file: "The Negotiator.png" },
      { id: "325", name: "The Night Before", rarity: "uncommon", file: "The Night Before.png" },
      { id: "326", name: "The Pact", rarity: "rare", file: "The Pact.png" },
      { id: "327", name: "The People's Knight", rarity: "rare", file: "The People's Knight.png" },
      { id: "328", name: "The Perfect Moment", rarity: "common", file: "The Perfect Moment.png" },
      { id: "329", name: "The Reborn", rarity: "common", file: "The Reborn.png" },
      { id: "330", name: "The Ritual", rarity: "rare", file: "The Ritual.png" },
      { id: "331", name: "The Sleepless Man", rarity: "uncommon", file: "The Sleepless Man.png" },
      { id: "332", name: "The Timer", rarity: "uncommon", file: "The Timer.png" },
      { id: "333", name: "The Vallobranch Family Blade", rarity: "legendary", file: "The Vallobranch Family Blade.png" },
      { id: "334", name: "The Vallobranch Family Blade X", rarity: "ultra x rare", file: "The Vallobranch Family Blade X.png" },
      { id: "335", name: "Thunderstorm", rarity: "common", file: "Thunderstorm.png" },
      { id: "336", name: "Too Much to Drink", rarity: "uncommon", file: "Too Much to Drink.png" },
      { id: "337", name: "Trained Hawk", rarity: "common", file: "Trained Hawk.png" },
      { id: "338", name: "Trash Panda", rarity: "common", file: "Trash Panda.png" },
      { id: "339", name: "Traveling Merchant", rarity: "uncommon", file: "Traveling Merchant.png" },
      { id: "340", name: "Trebuchet Tactics", rarity: "rare", file: "Trebuchet Tactics.png" },
      { id: "341", name: "Tremors", rarity: "uncommon", file: "Tremors.png" },
      { id: "342", name: "Trench Diggers", rarity: "common", file: "Trench Diggers.png" },
      { id: "343", name: "Turn the Other Way", rarity: "common", file: "Turn the Other Way.png" },
      { id: "344", name: "Unchained Tiger", rarity: "uncommon", file: "Unchained Tiger.png" },
      { id: "345", name: "Uncontrollable Bloom", rarity: "legendary", file: "Uncontrollable Bloom.png" },
      { id: "346", name: "Under the Stars", rarity: "common", file: "Under the Stars.png" },
      { id: "347", name: "Unnamed Slaves", rarity: "common", file: "Unnamed Slaves.png" },
      { id: "348", name: "Unseen Forces", rarity: "rare", file: "Unseen Forces.png" },
      { id: "349", name: "Unseen Terror-Monger", rarity: "common", file: "Unseen Terror-Monger.png" },
      { id: "350", name: "Used Chainmail", rarity: "uncommon", file: "Used Chainmail.png" },
      { id: "351", name: "Utility Belt", rarity: "common", file: "Utility Belt.png" },
      { id: "352", name: "Vallobranch Riches", rarity: "uncommon", file: "Vallobranch Riches.png" },
      { id: "353", name: "Valuable Prisoner", rarity: "rare", file: "Valuable Prisoner.png" },
      { id: "354", name: "Veiled Guard of Stars", rarity: "common", file: "Veiled Guard of Stars.png" },
      { id: "355", name: "Vesta's Roar", rarity: "rare", file: "Vesta's Roar.png" },
      { id: "356", name: "Victorious!", rarity: "common", file: "Victorious!.png" },
      { id: "357", name: "Viero and Shara", rarity: "rare", file: "Viero and Shara.png" },
      { id: "358", name: "Viero's Family Ring", rarity: "rare", file: "Viero's Family Ring.png" },
      { id: "359", name: "Violetta Shadowhunt", rarity: "rare", file: "Violetta Shadowhunt.png" },
      { id: "360", name: "Violetta Shadowhunt X", rarity: "ultra x rare", file: "Violetta Shadowhunt X.png" },
      { id: "361", name: "Violetta, First Meeting", rarity: "rare", file: "Violetta, First Meeting.png" },
      { id: "362", name: "Violetta's Gamble", rarity: "rare", file: "Violetta's Gamble.png" },
      { id: "363", name: "Violetta's Mistakes", rarity: "rare", file: "Violetta's Mistakes.png" },
      { id: "364", name: "Violetta's Straight Sword, Oathtaker", rarity: "legendary", file: "Violetta's Straight Sword, Oathtaker.png" },
      { id: "365", name: "Violetta's Straight Sword, Oathtaker X", rarity: "ultra x rare", file: "Violetta's Straight Sword, Oathtaker X.png" },
      { id: "366", name: "Visions", rarity: "uncommon", file: "Visions.png" },
      { id: "367", name: "Vodd, Tamed", rarity: "rare", file: "Vodd, Tamed.png" },
      { id: "368", name: "Vodd's Champion", rarity: "uncommon", file: "Vodd's Champion.png" },
      { id: "369", name: "Vodd's Dual Swords, Tyrant and Tamer", rarity: "legendary", file: "Vodd's Dual Swords, Tyrant and Tamer.png" },
      { id: "370", name: "Vodd's Dual Swords, Tyrant and Tamer X", rarity: "ultra x rare", file: "Vodd's Dual Swords, Tyrant and Tamer X.png" },
      { id: "371", name: "Vodd's Duststorm", rarity: "uncommon", file: "Vodd's Duststorm.png" },
      { id: "372", name: "Vodd's Visions", rarity: "rare", file: "Vodd's Visions.png" },
      { id: "373", name: "Wannabe Killer", rarity: "common", file: "Wannabe Killer.png" },
      { id: "374", name: "War Horse", rarity: "common", file: "War Horse.png" },
      { id: "375", name: "Washed Clean", rarity: "common", file: "Washed Clean.png" },
      { id: "376", name: "Wasted Talent", rarity: "common", file: "Wasted Talent.png" },
      { id: "377", name: "Weary Traveller", rarity: "common", file: "Weary Traveller.png" },
      { id: "378", name: "Well Thought Plan", rarity: "uncommon", file: "Well Thought Plan.png" },
      { id: "379", name: "What the Future Holds", rarity: "rare", file: "What the Future Holds.png" },
      { id: "380", name: "Wide Swing", rarity: "uncommon", file: "Wide Swing.png" },
      { id: "381", name: "Wild Visionary", rarity: "common", file: "Wild Visionary.png" },
      { id: "382", name: "Words, Soft Spoken", rarity: "uncommon", file: "Words, Soft Spoken.png" },
      { id: "383", name: "Ymra, Barbarica", rarity: "rare", file: "Ymra, Barbarica.png" },
      { id: "384", name: "Ymra, Covered In Blood", rarity: "rare", file: "Ymra, Covered In Blood.png" },
      { id: "385", name: "Ymra's Axe of the Sun", rarity: "legendary", file: "Ymra's Axe of the Sun.png" },
      { id: "386", name: "Ymra's Axe of the Sun X", rarity: "ultra x rare", file: "Ymra's Axe of the Sun X.png" },
      { id: "387", name: "Ymra's Chosen Sacrifice", rarity: "uncommon", file: "Ymra's Chosen Sacrifice.png" },
      { id: "388", name: "Ymra's Prayers", rarity: "uncommon", file: "Ymra's Prayers.png" },
      { id: "389", name: "Ymra's Wolves", rarity: "uncommon", file: "Ymra's Wolves.png" },
      { id: "390", name: "Young Fil", rarity: "common", file: "Young Fil.png" },
      { id: "391", name: "Yun-Wa, Advisor", rarity: "common", file: "Yun-Wa, Advisor.png" }
    ];

    const CARDS_BY_RARITY = {
      common: ALL_CARDS.filter(c => c.rarity === 'common'),
      uncommon: ALL_CARDS.filter(c => c.rarity === 'uncommon'),
      rare: ALL_CARDS.filter(c => c.rarity === 'rare'),
      legendary: ALL_CARDS.filter(c => c.rarity === 'legendary'),
      'ultra x rare': ALL_CARDS.filter(c => c.rarity === 'ultra x rare')
    };

    const RARITY_COLORS = {
      common: { bg: '#4b5563', border: '#9ca3af', text: '#d1d5db' },
      uncommon: { bg: '#15803d', border: '#4ade80', text: '#86efac' },
      rare: { bg: '#1d4ed8', border: '#60a5fa', text: '#93c5fd' },
      legendary: { bg: '#7e22ce', border: '#a855f7', text: '#c4b5fd' },
      'ultra x rare': { bg: '#dc2626', border: '#fbbf24', text: '#fef08a' }
    };
    const RARITY_ORDER = ['common', 'uncommon', 'rare', 'legendary', 'ultra x rare'];

    const getImageUrl = (card) => {
      const folder = card.rarity.replace(/ /g, '%20');
      const filename = card.file.replace(/ /g, '%20');
      return `${GITHUB_BASE}/${folder}/${filename}`;
    };

    // --- MAIN COMPONENT ---
    function TCGPackOpener() {
      // --- CORE STATE ---
      const [collection, setCollection] = useState({});
      const [packInventory, setPackInventory] = useState([]);
      const [rations, setRations] = useState(0);
      const [gameDay, setGameDay] = useState(1);
      const [marketValues, setMarketValues] = useState({});
      const [holoMultipliers, setHoloMultipliers] = useState({});
      const [priceHistory, setPriceHistory] = useState({});
      const [sealedInventory, setSealedInventory] = useState({ bundle: 0, booster: 0, case: 0 });
      
      const [view, setView] = useState('home');
      const [isLoaded, setIsLoaded] = useState(false);
      const [menuOpen, setMenuOpen] = useState(false);

      // --- OPENING STATE ---
      const [packCards, setPackCards] = useState([]);
      const [revealedCount, setRevealedCount] = useState(0); // Tracking index
      const [isPeeking, setIsPeeking] = useState(false);
      const [lastPackWasGod, setLastPackWasGod] = useState(false);
      const [godPackActive, setGodPackActive] = useState(false);
      const [godPackConfetti, setGodPackConfetti] = useState([]);
      const [showGodPackGate, setShowGodPackGate] = useState(false);

      // --- SHOP / MODAL STATE ---
      const [enlargedCard, setEnlargedCard] = useState(null);
      const [purchaseConfirm, setPurchaseConfirm] = useState(null);
      const [sellConfirm, setSellConfirm] = useState(null);
      const [shopStock, setShopStock] = useState(null);
      const [dailyShopPicks, setDailyShopPicks] = useState({});
      const [dailyShopDate, setDailyShopDate] = useState('');
      const [freeStarterClaimed, setFreeStarterClaimed] = useState(false);
      const [shopTab, setShopTab] = useState('buy');
      const [shopSellSearch, setShopSellSearch] = useState('');
      const [shopSellFilter, setShopSellFilter] = useState('all');
      const [shopSellVariant, setShopSellVariant] = useState('any');
      const [shopSellSort, setShopSellSort] = useState('payout');
      
      // --- COLLECTION FILTER STATE ---
      const [collectionFilter, setCollectionFilter] = useState('all');
      const [collectionSearch, setCollectionSearch] = useState('');
      const [ownedFilter, setOwnedFilter] = useState('all');
      const [holoFilter, setHoloFilter] = useState('all');
      const [sortKey, setSortKey] = useState('owned');
      const [sortDir, setSortDir] = useState('desc');
      const [hideUnknown, setHideUnknown] = useState(false);

      // --- SETTINGS / MISC ---
      const [saveSeed, setSaveSeed] = useState(0);
      const [eventLog, setEventLog] = useState([]);
      const [selectedEvent, setSelectedEvent] = useState(null);
      const [settingsMsg, setSettingsMsg] = useState('');
      const [exportText, setExportText] = useState('');
      const [importText, setImportText] = useState('');

      const rand = () => Math.random();

      // --- LOAD / SAVE ---
      useEffect(() => {
        try {
          const col = JSON.parse(localStorage.getItem('tcg-collection-v3') || '{}');
          setCollection(col);
          const inv = JSON.parse(localStorage.getItem('tcg-pack-inventory') || '[]');
          setPackInventory(inv);
          const sinv = JSON.parse(localStorage.getItem('tcg-sealed-inventory') || '{"bundle":0,"booster":0,"case":0}');
          setSealedInventory(sinv);
          setRations(parseFloat(localStorage.getItem('tcg-rations') || '0'));
          setGameDay(parseInt(localStorage.getItem('tcg-game-day') || '1', 10));
          setFreeStarterClaimed(localStorage.getItem('tcg-free-starter-claimed') === '1');
          setEventLog(JSON.parse(localStorage.getItem('tcg-events') || '[]'));
          
          let mv = JSON.parse(localStorage.getItem('tcg-market-current') || '{}');
          let hm = JSON.parse(localStorage.getItem('tcg-holo-multipliers') || '{}');
          let ph = JSON.parse(localStorage.getItem('tcg-price-history') || '{}');
          
          if(Object.keys(mv).length === 0) {
             // init market if empty
             ALL_CARDS.forEach(c => {
               let v=1; 
               if(c.rarity==='common') v = rand()*5+0.5;
               else if(c.rarity==='uncommon') v = rand()*6.5+1.5;
               else if(c.rarity==='rare') v = rand()*21.5+3.5;
               else if(c.rarity==='legendary') v = rand()*77.75+9.25;
               else v = rand()*797+23;
               mv[c.id] = parseFloat(v.toFixed(2));
               hm[c.id] = rand()*1.4+1.1;
               ph[c.id] = [{day:1, value:mv[c.id]}];
             });
             localStorage.setItem('tcg-market-current', JSON.stringify(mv));
             localStorage.setItem('tcg-holo-multipliers', JSON.stringify(hm));
             localStorage.setItem('tcg-price-history', JSON.stringify(ph));
          }
          setMarketValues(mv);
          setHoloMultipliers(hm);
          setPriceHistory(ph);

          // Daily Shop Init
          let picks = JSON.parse(localStorage.getItem('tcg-daily-shop-picks') || '{}');
          if(Object.keys(picks).length === 0) picks = generateDailyShopPicks();
          setDailyShopPicks(picks);
          
          let stock = JSON.parse(localStorage.getItem('tcg-shop-stock') || 'null');
          if(!stock) stock = generateDailyShopStock(1);
          setShopStock(stock);

        } catch(e) { console.error(e); }
        setIsLoaded(true);
      }, []);

      const saveCol = (c) => { setCollection(c); localStorage.setItem('tcg-collection-v3', JSON.stringify(c)); };
      const saveInv = (i) => { setPackInventory(i); localStorage.setItem('tcg-pack-inventory', JSON.stringify(i)); };
      const saveSInv = (i) => { setSealedInventory(i); localStorage.setItem('tcg-sealed-inventory', JSON.stringify(i)); };
      const saveRat = (r) => { setRations(r); localStorage.setItem('tcg-rations', String(r)); };

      // --- LOGIC: MARKET (UPDATED FOR 8 CARDS) ---
      const sealedMarket = useMemo(() => {
        const getVal = (id) => marketValues[id] || 0;
        const avgRarity = (rarity, holo) => {
          const list = CARDS_BY_RARITY[rarity];
          if(!list.length) return 0;
          let sum = 0;
          list.forEach(c => sum += getVal(c.id) * (holo ? (holoMultipliers[c.id]||1.5) : 1));
          return sum / list.length;
        };
        // 8 Card Formula
        const cEV = avgRarity('common', false);
        const uEV = avgRarity('uncommon', false);
        const rSlotEV = 0.89 * avgRarity('rare', false) + 0.10 * avgRarity('legendary', false) + 0.01 * avgRarity('ultra x rare', false);
        const hSlotEV = 0.47 * avgRarity('common', true) + 0.34 * avgRarity('uncommon', true) + 0.13 * avgRarity('rare', true) + 0.05 * avgRarity('legendary', true) + 0.01 * avgRarity('ultra x rare', true);
        const packEV = (4 * cEV) + (2 * uEV) + rSlotEV + hSlotEV;
        
        const price = packEV > 0 ? Math.max(1, packEV) : 10;

        return {
          single: price,
          bundle: price * 7.5,
          booster: price * 20,
          case: price * 100,
          age: gameDay,
          curEV: packEV,
          baseEV: 10 // Arbitrary base for diff
        };
      }, [marketValues, holoMultipliers, gameDay]);

      // --- LOGIC: PACK OPENING (UPDATED) ---
      const generatePackId = () => `pack_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
      const getRandomCard = (rarity) => {
        const list = CARDS_BY_RARITY[rarity];
        return list[Math.floor(rand() * list.length)];
      };

      const openPack = () => {
         if(packInventory.length === 0) return;
         const packType = packInventory[0];
         const newInv = packInventory.slice(1);
         saveInv(newInv);

         // God Pack Chance (1/1000)
         const isGod = (rand() < 0.001) || packType.isGodPack;
         if(isGod) {
            setLastPackWasGod(true);
            setGodPackActive(true);
            triggerGodPackEffect();
            if(!packType.isGodPack) setShowGodPackGate(true); // Only show gate if it was a surprise
         } else {
            setLastPackWasGod(false);
            setGodPackActive(false);
         }

         let cards = [];
         let slot = 0;

         if(isGod) {
            // 8 God Cards
            for(let i=0; i<8; i++) {
               const r = rand();
               const rarity = r < 0.4 ? 'rare' : (r < 0.8 ? 'legendary' : 'ultra x rare');
               const c = getRandomCard(rarity);
               cards.push({ ...c, image: getImageUrl(c), isHolo: true, slot: slot++, isGodPack: true });
            }
         } else {
            // 8 Normal Cards
            // 4 Common
            for(let i=0; i<4; i++) cards.push({ ...getRandomCard('common'), slot: slot++ });
            // 2 Uncommon
            for(let i=0; i<2; i++) cards.push({ ...getRandomCard('uncommon'), slot: slot++ });
            // 1 Rare Slot
            const rRoll = rand();
            const rRarity = rRoll < 0.89 ? 'rare' : (rRoll < 0.99 ? 'legendary' : 'ultra x rare');
            cards.push({ ...getRandomCard(packType.forceRarity || rRarity), slot: slot++ });
            // 1 Holo Slot
            const hRoll = rand();
            const hRarity = hRoll < 0.47 ? 'common' : (hRoll < 0.81 ? 'uncommon' : (hRoll < 0.94 ? 'rare' : (hRoll < 0.99 ? 'legendary' : 'ultra x rare')));
            cards.push({ ...getRandomCard(hRarity), isHolo: true, slot: slot++ });
         }

         // Preload images
         cards.forEach(c => { new Image().src = c.image; });

         setPackCards(cards);
         setRevealedCount(0);
         setView('opening');
      };

      const revealNextCard = () => {
         if(revealedCount >= packCards.length) return;
         const card = packCards[revealedCount];
         const newCol = { ...collection };
         const entry = newCol[card.id] || { normal: 0, holo: 0 };
         if(card.isHolo) entry.holo++; else entry.normal++;
         newCol[card.id] = entry;
         saveCol(newCol);
         setRevealedCount(prev => prev + 1);
      };

      const triggerGodPackEffect = () => {
        const pieces = Array.from({ length: 42 }, () => ({
          left: (rand()*100).toFixed(2)+'vw',
          dur: (1.2+rand()).toFixed(2)+'s',
          delay: (rand()*0.25).toFixed(2)+'s',
          w: (6+rand()*10).toFixed(0)+'px',
          h: (8+rand()*14).toFixed(0)+'px',
          c: `hsl(${Math.floor(rand()*360)}, 90%, 60%)`
        }));
        setGodPackConfetti(pieces);
        setTimeout(() => setGodPackActive(false), 2000);
      };

      // --- LOGIC: SHOP & ADVANCE DAY ---
      const generateDailyShopPicks = () => {
        const picks = {};
        RARITY_ORDER.forEach(r => picks[r] = getRandomCard(r).id);
        return picks;
      };
      const generateDailyShopStock = (d) => ({
        day: d,
        single: { limit: 10, remaining: 10 },
        bundle: { limit: 5, remaining: 5 },
        booster: { limit: 2, remaining: 2 },
        case: { limit: 1, remaining: 1 }
      });
      
      const advanceDay = () => {
         const nd = gameDay + 1;
         setGameDay(nd);
         localStorage.setItem('tcg-game-day', String(nd));
         
         // Fluctuate Market
         const nmv = { ...marketValues };
         const nph = { ...priceHistory };
         const breakouts = Array.from({length: 40}, () => ALL_CARDS[Math.floor(rand()*ALL_CARDS.length)].id);
         
         ALL_CARDS.forEach(c => {
            const isBreakout = breakouts.includes(c.id);
            const fluctuation = (rand() * 0.30) - 0.15; 
            let nv = nmv[c.id] * (1 + fluctuation);
            if(isBreakout) nv = nv * (rand() > 0.5 ? 1.5 : 0.5); // Breakout swing
            nmv[c.id] = parseFloat(nv.toFixed(2));
            
            // History
            if(!nph[c.id]) nph[c.id] = [];
            nph[c.id].push({ day: nd, value: nmv[c.id] });
            if(nph[c.id].length > 30) nph[c.id].shift();
         });
         
         setMarketValues(nmv);
         setPriceHistory(nph);
         localStorage.setItem('tcg-market-current', JSON.stringify(nmv));
         localStorage.setItem('tcg-price-history', JSON.stringify(nph));

         // Reset Shop
         setDailyShopPicks(generateDailyShopPicks());
         setShopStock(generateDailyShopStock(nd));
         localStorage.setItem('tcg-daily-shop-picks', JSON.stringify(generateDailyShopPicks()));
         localStorage.setItem('tcg-shop-stock', JSON.stringify(generateDailyShopStock(nd)));
      };

      // --- HELPERS ---
      const buyItem = (type, cost) => {
         if(rations < cost) return;
         if(shopStock && shopStock[type] && shopStock[type].remaining <= 0) return;
         
         saveRat(rations - cost);
         if(type === 'single') saveInv([...packInventory, { id: generatePackId(), type: 'single' }]);
         if(type === 'bundle') {
            const p = Array(8).fill(null).map((_,i) => ({ id: generatePackId(), type: 'bundle', forceRarity: i===0?'legendary':null }));
            saveInv([...packInventory, ...p]);
            saveSInv({ ...sealedInventory, bundle: sealedInventory.bundle + 1 });
         }
         if(type === 'booster') {
             const p = Array(24).fill(null).map((_,i) => ({ id: generatePackId(), type: 'booster', forceRarity: i<4?'legendary':null }));
             saveInv([...packInventory, ...p]);
             saveSInv({ ...sealedInventory, booster: sealedInventory.booster + 1 });
         }
         if(type === 'case') {
             const p = Array(144).fill(null).map((_,i) => ({ id: generatePackId(), type: 'case', forceRarity: i<2?'ultra x rare':null }));
             saveInv([...packInventory, ...p]);
             saveSInv({ ...sealedInventory, case: sealedInventory.case + 1 });
         }

         // Reduce stock
         if(shopStock && shopStock[type]) {
            const ns = { ...shopStock, [type]: { ...shopStock[type], remaining: shopStock[type].remaining - 1 } };
            setShopStock(ns);
            localStorage.setItem('tcg-shop-stock', JSON.stringify(ns));
         }
         setPurchaseConfirm(null);
      };
      
      const sellCard = (id, variant) => {
         const entry = collection[id];
         if(!entry) return;
         const val = variant === 'holo' 
            ? (marketValues[id] * holoMultipliers[id] * 0.6) 
            : (marketValues[id] * 0.6);
            
         saveRat(rations + val);
         
         const nc = { ...collection };
         if(variant === 'holo') nc[id].holo--; else nc[id].normal--;
         if(nc[id].normal <= 0 && nc[id].holo <= 0) delete nc[id];
         saveCol(nc);
         setSellConfirm(null);
      };
      
      const getCollectionCards = () => {
         let list = ALL_CARDS.filter(c => {
            if(collectionFilter !== 'all' && c.rarity !== collectionFilter) return false;
            if(collectionSearch && !c.name.toLowerCase().includes(collectionSearch.toLowerCase())) return false;
            const entry = collection[c.id];
            const owned = entry && (entry.normal > 0 || entry.holo > 0);
            if(ownedFilter === 'owned' && !owned) return false;
            if(ownedFilter === 'unowned' && owned) return false;
            return true;
         });
         return list.map(c => {
             const entry = collection[c.id] || { normal: 0, holo: 0 };
             return { ...c, owned: entry.normal+entry.holo, normal: entry.normal, holo: entry.holo, val: marketValues[c.id] };
         }).sort((a,b) => b.owned - a.owned);
      };

      if (!isLoaded) return <div style={{ color: 'white', padding: 20 }}>Loading TCG...</div>;

      // --- JSX ---
      return (
        <div style={{ minHeight: '100vh', paddingBottom: 40 }}>
           
           {/* GLOBAL EFFECTS */}
           {godPackActive && (
             <div className="godpack-effect">
               {godPackConfetti.map((p,i) => (
                  <div key={i} className="confetti-piece" style={{ '--left': p.left, '--dur': p.dur, '--delay': p.delay, '--w': p.w, '--h': p.h, '--c': p.c }} />
               ))}
             </div>
           )}
           {showGodPackGate && (
              <div className="godpack-gate">
                 <div className="godpack-gate-card">
                    <h2>GOD PACK</h2>
                    <p>Every card in this pack is holographic!</p>
                    <button onClick={() => setShowGodPackGate(false)} style={{ padding: '10px 20px', background: '#a855f7', color: 'white', border: 'none', borderRadius: 8 }}>OPEN</button>
                 </div>
              </div>
           )}

           {/* TOPBAR */}
           <header className="topbar" style={{ background: 'rgba(17,24,39,0.95)', borderBottom: '1px solid #a855f7', padding: '12px 16px', position: 'sticky', top: 0, zIndex: 100, display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
             <h1 style={{ fontSize: 20, margin: 0, background: 'linear-gradient(90deg, #a855f7, #ec4899)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', fontWeight: 900 }}>Through The Ages</h1>
             <div style={{ display: 'flex', gap: 12, alignItems: 'center' }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: 6, background: 'rgba(255,255,255,0.1)', padding: '4px 8px', borderRadius: 8 }}>
                   <img src="./rations.png" width="16" />
                   <span style={{ color: '#fbbf24', fontWeight: 'bold' }}>{rations.toFixed(0)}</span>
                </div>
                <div style={{ fontSize: 14, color: '#9ca3af' }}>Day {gameDay}</div>
                <button onClick={advanceDay} style={{ background: '#10b981', border: 'none', color: 'white', borderRadius: 6, padding: '4px 8px', fontSize: 12, cursor: 'pointer' }}>Next Day</button>
                <button className="hamburger-btn" onClick={() => setMenuOpen(!menuOpen)} style={{ background: 'transparent', border: '1px solid #4b5563', color: 'white', borderRadius: 6, padding: '4px 8px' }}></button>
                <nav className="topbar-nav" style={{ display: 'flex', gap: 8 }}>
                   <button onClick={() => setView('home')} style={{ background: view==='home'?'#9333ea':'transparent', border: 'none', color: 'white', padding: '6px 12px', borderRadius: 6, cursor: 'pointer' }}>Home</button>
                   <button onClick={() => setView('shop')} style={{ background: view==='shop'?'#9333ea':'transparent', border: 'none', color: 'white', padding: '6px 12px', borderRadius: 6, cursor: 'pointer' }}>Shop</button>
                   <button onClick={() => setView('collection')} style={{ background: view==='collection'?'#9333ea':'transparent', border: 'none', color: 'white', padding: '6px 12px', borderRadius: 6, cursor: 'pointer' }}>Collection</button>
                   <button onClick={() => setView('settings')} style={{ background: view==='settings'?'#9333ea':'transparent', border: 'none', color: 'white', padding: '6px 12px', borderRadius: 6, cursor: 'pointer' }}>Settings</button>
                </nav>
             </div>
           </header>

           {menuOpen && (
              <div className="menu-panel">
                 <button onClick={() => { setView('home'); setMenuOpen(false); }} style={{ display: 'block', width: '100%', textAlign: 'left', padding: 12, background: 'transparent', border: 'none', color: 'white', borderBottom: '1px solid #374151' }}>Inventory</button>
                 <button onClick={() => { setView('shop'); setMenuOpen(false); }} style={{ display: 'block', width: '100%', textAlign: 'left', padding: 12, background: 'transparent', border: 'none', color: 'white', borderBottom: '1px solid #374151' }}>Shop</button>
                 <button onClick={() => { setView('collection'); setMenuOpen(false); }} style={{ display: 'block', width: '100%', textAlign: 'left', padding: 12, background: 'transparent', border: 'none', color: 'white', borderBottom: '1px solid #374151' }}>Collection</button>
                 <button onClick={() => { setView('settings'); setMenuOpen(false); }} style={{ display: 'block', width: '100%', textAlign: 'left', padding: 12, background: 'transparent', border: 'none', color: 'white' }}>Settings</button>
              </div>
           )}

           <main style={{ maxWidth: 1000, margin: '0 auto', padding: 20 }}>
             
             {/* --- HOME VIEW --- */}
             {view === 'home' && (
                <div style={{ textAlign: 'center' }}>
                   <div style={{ marginBottom: 30 }}>
                      <h2 style={{ fontSize: 28, marginBottom: 10 }}>Inventory</h2>
                      <div style={{ display: 'flex', justifyContent: 'center', gap: 20, color: '#9ca3af' }}>
                         <div>Packs: <b>{packInventory.length}</b></div>
                         <div>Collection: <b>{Object.keys(collection).length}/{ALL_CARDS.length}</b></div>
                      </div>
                   </div>

                   {packInventory.length > 0 ? (
                      <div onClick={openPack} style={{ width: 220, margin: '0 auto', cursor: 'pointer', transition: 'transform 0.2s' }} onMouseEnter={e => e.currentTarget.style.transform='scale(1.05)'} onMouseLeave={e => e.currentTarget.style.transform='scale(1)'}>
                         <img src="./cardback.png" style={{ width: '100%', borderRadius: 14, boxShadow: '0 20px 40px rgba(168,85,247,0.3)', border: '2px solid #a855f7' }} />
                         <div style={{ marginTop: 16, fontWeight: 'bold', color: '#e879f9', fontSize: 18 }}>TAP TO OPEN</div>
                      </div>
                   ) : (
                      <div style={{ padding: 60, border: '2px dashed #4b5563', borderRadius: 16, color: '#9ca3af' }}>
                         <div style={{ fontSize: 40, marginBottom: 10 }}></div>
                         No packs available.
                         <br/><br/>
                         <button onClick={() => setView('shop')} style={{ background: '#9333ea', border: 'none', padding: '12px 24px', color: 'white', borderRadius: 8, cursor: 'pointer', fontSize: 16, fontWeight: 'bold' }}>Visit Shop</button>
                      </div>
                   )}
                </div>
             )}

             {/* --- OPENING VIEW (STACK) --- */}
             {view === 'opening' && (
               <div>
                  <div className={`stack-container ${isPeeking ? 'peeking' : ''}`}>
                     {packCards.map((card, index) => {
                        if (index < revealedCount) return null;
                        const zIndex = 100 - index;
                        const peekOffset = isPeeking ? (index - revealedCount) * 40 : 0;
                        const colors = RARITY_COLORS[card.rarity];
                        
                        return (
                           <div 
                              key={card.slot} 
                              className="stack-card"
                              style={{ 
                                 zIndex, 
                                 transform: `translateX(${peekOffset}px) rotate(${(index % 3) - 1}deg)`,
                                 border: `3px solid ${colors.border}`
                              }}
                              onClick={() => { if(index === revealedCount) revealNextCard(); }}
                           >
                              <img src="./cardback.png" style={{ width: '100%', height: '100%', objectFit: 'cover' }} />
                           </div>
                        )
                     })}

                     {revealedCount === packCards.length && (
                        <div style={{ position: 'absolute', textAlign: 'center', zIndex: 200 }}>
                           <h3 style={{ fontSize: 32, textShadow: '0 4px 10px black', margin: '0 0 20px 0' }}>Pack Complete!</h3>
                           <div style={{ display: 'flex', gap: 10 }}>
                              <button onClick={() => setView('home')} style={{ padding: '12px 24px', background: '#374151', color: 'white', border: 'none', borderRadius: 8, cursor: 'pointer', fontWeight: 'bold' }}>Done</button>
                              {packInventory.length > 0 && (
                                 <button onClick={openPack} style={{ padding: '12px 24px', background: '#9333ea', color: 'white', border: 'none', borderRadius: 8, cursor: 'pointer', fontWeight: 'bold' }}>Next Pack</button>
                              )}
                           </div>
                        </div>
                     )}
                  </div>

                  {revealedCount < packCards.length && (
                     <div style={{ textAlign: 'center', marginBottom: 20 }}>
                        <button
                           onMouseDown={() => setIsPeeking(true)}
                           onMouseUp={() => setIsPeeking(false)}
                           onTouchStart={() => setIsPeeking(true)}
                           onTouchEnd={() => setIsPeeking(false)}
                           style={{
                              background: '#eab308', color: '#422006', fontWeight: 900,
                              border: 'none', borderRadius: 99, padding: '14px 32px', fontSize: 16,
                              boxShadow: '0 4px 0 #a16207', transform: isPeeking ? 'translateY(4px)' : 'none',
                              transition: 'transform 0.1s'
                           }}
                        >
                           HOLD TO PEEK
                        </button>
                        <p style={{ marginTop: 12, fontSize: 13, color: '#9ca3af' }}>Tap stack to flip  Hold to see edges</p>
                     </div>
                  )}

                  <div className="reveal-grid">
                     {packCards.slice(0, revealedCount).map(card => {
                        const colors = RARITY_COLORS[card.rarity];
                        return (
                           <div key={card.slot} onClick={() => setEnlargedCard(card)} className={card.isHolo ? 'foil-glow' : ''} style={{ aspectRatio: '2.5/3.5', borderRadius: 8, border: `2px solid ${colors.border}`, overflow: 'hidden', cursor: 'pointer' }}>
                              <img src={card.image} style={{ width: '100%', height: '100%', objectFit: 'cover' }} />
                           </div>
                        )
                     })}
                  </div>
               </div>
             )}

             {/* --- SHOP VIEW --- */}
             {view === 'shop' && (
                <div>
                   <h2 style={{ textAlign: 'center', marginBottom: 20 }}>Shop</h2>
                   
                   <div style={{ display: 'flex', gap: 10, justifyContent: 'center', marginBottom: 20 }}>
                      <button onClick={() => setShopTab('buy')} style={{ padding: '8px 16px', borderRadius: 20, border: 'none', background: shopTab==='buy'?'#9333ea':'#374151', color: 'white', cursor: 'pointer' }}>Buy Sealed</button>
                      <button onClick={() => setShopTab('sell')} style={{ padding: '8px 16px', borderRadius: 20, border: 'none', background: shopTab==='sell'?'#9333ea':'#374151', color: 'white', cursor: 'pointer' }}>Sell Cards</button>
                   </div>

                   {shopTab === 'buy' && (
                      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(220px, 1fr))', gap: 20 }}>
                         {/* Single Pack */}
                         <div style={{ background: '#1f2937', padding: 20, borderRadius: 12, border: '1px solid #374151' }}>
                            <img src="./cardback.png" style={{ width: 80, float: 'right', borderRadius: 6 }} />
                            <h3 style={{ margin: '0 0 5px 0' }}>Single Pack</h3>
                            <div style={{ fontSize: 12, color: '#9ca3af' }}>8 Cards</div>
                            <div style={{ marginTop: 10, fontWeight: 'bold', color: '#fbbf24' }}>{sealedMarket.single.toFixed(0)} R</div>
                            <div style={{ fontSize: 11, color: '#6b7280', marginBottom: 10 }}>Stock: {shopStock.single.remaining}/{shopStock.single.limit}</div>
                            <button onClick={() => setPurchaseConfirm({ type: 'single', cost: sealedMarket.single, title: 'Single Pack' })} disabled={shopStock.single.remaining <= 0} style={{ width: '100%', padding: 8, background: '#2563eb', border: 'none', borderRadius: 6, color: 'white', cursor: 'pointer', opacity: shopStock.single.remaining <= 0 ? 0.5 : 1 }}>Buy</button>
                         </div>

                         {/* Bundle */}
                         <div style={{ background: '#1f2937', padding: 20, borderRadius: 12, border: '1px solid #10b981' }}>
                            <h3 style={{ margin: '0 0 5px 0', color: '#34d399' }}>Bundle</h3>
                            <div style={{ fontSize: 12, color: '#9ca3af' }}>8 Packs  1 Legendary</div>
                            <div style={{ marginTop: 10, fontWeight: 'bold', color: '#fbbf24' }}>{sealedMarket.bundle.toFixed(0)} R</div>
                            <div style={{ fontSize: 11, color: '#6b7280', marginBottom: 10 }}>Stock: {shopStock.bundle.remaining}/{shopStock.bundle.limit}</div>
                            <button onClick={() => setPurchaseConfirm({ type: 'bundle', cost: sealedMarket.bundle, title: 'Bundle Box' })} disabled={shopStock.bundle.remaining <= 0} style={{ width: '100%', padding: 8, background: '#059669', border: 'none', borderRadius: 6, color: 'white', cursor: 'pointer', opacity: shopStock.bundle.remaining <= 0 ? 0.5 : 1 }}>Buy</button>
                         </div>
                         
                         {/* Booster */}
                         <div style={{ background: '#1f2937', padding: 20, borderRadius: 12, border: '1px solid #3b82f6' }}>
                            <h3 style={{ margin: '0 0 5px 0', color: '#60a5fa' }}>Booster Box</h3>
                            <div style={{ fontSize: 12, color: '#9ca3af' }}>24 Packs  4 Legendaries</div>
                            <div style={{ marginTop: 10, fontWeight: 'bold', color: '#fbbf24' }}>{sealedMarket.booster.toFixed(0)} R</div>
                            <div style={{ fontSize: 11, color: '#6b7280', marginBottom: 10 }}>Stock: {shopStock.booster.remaining}/{shopStock.booster.limit}</div>
                            <button onClick={() => setPurchaseConfirm({ type: 'booster', cost: sealedMarket.booster, title: 'Booster Box' })} disabled={shopStock.booster.remaining <= 0} style={{ width: '100%', padding: 8, background: '#2563eb', border: 'none', borderRadius: 6, color: 'white', cursor: 'pointer', opacity: shopStock.booster.remaining <= 0 ? 0.5 : 1 }}>Buy</button>
                         </div>

                         {/* Case */}
                         <div style={{ background: '#1f2937', padding: 20, borderRadius: 12, border: '1px solid #f59e0b' }}>
                            <h3 style={{ margin: '0 0 5px 0', color: '#fbbf24' }}>Case</h3>
                            <div style={{ fontSize: 12, color: '#9ca3af' }}>144 Packs  2 Ultra X</div>
                            <div style={{ marginTop: 10, fontWeight: 'bold', color: '#fbbf24' }}>{sealedMarket.case.toFixed(0)} R</div>
                            <div style={{ fontSize: 11, color: '#6b7280', marginBottom: 10 }}>Stock: {shopStock.case.remaining}/{shopStock.case.limit}</div>
                            <button onClick={() => setPurchaseConfirm({ type: 'case', cost: sealedMarket.case, title: 'Master Case' })} disabled={shopStock.case.remaining <= 0} style={{ width: '100%', padding: 8, background: '#d97706', border: 'none', borderRadius: 6, color: 'white', cursor: 'pointer', opacity: shopStock.case.remaining <= 0 ? 0.5 : 1 }}>Buy</button>
                         </div>
                      </div>
                   )}

                   {shopTab === 'sell' && (
                      <div>
                         <div style={{ padding: 15, background: '#1f2937', borderRadius: 12, marginBottom: 20 }}>
                            <h3 style={{ margin: '0 0 10px 0' }}>Sell Cards</h3>
                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 10, marginBottom: 10 }}>
                               <input value={shopSellSearch} onChange={e => setShopSellSearch(e.target.value)} placeholder="Search..." style={{ padding: 8, background: '#374151', border: 'none', color: 'white', borderRadius: 6 }} />
                               <select value={shopSellFilter} onChange={e => setShopSellFilter(e.target.value)} style={{ padding: 8, background: '#374151', border: 'none', color: 'white', borderRadius: 6 }}>
                                  <option value="all">All Rarities</option>
                                  {RARITY_ORDER.map(r => <option key={r} value={r}>{r}</option>)}
                               </select>
                            </div>
                            <p style={{ fontSize: 12, color: '#9ca3af' }}>Shop buys at 60% market value.</p>
                         </div>
                         
                         <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(280px, 1fr))', gap: 10 }}>
                            {getCollectionCards().map(c => {
                               const owned = c.normal + c.holo > 0;
                               if(!owned) return null;
                               const colors = RARITY_COLORS[c.rarity];
                               return (
                                  <div key={c.id} style={{ display: 'flex', gap: 10, background: '#1f2937', padding: 10, borderRadius: 8, border: `1px solid ${colors.border}` }}>
                                     <img src={getImageUrl(c)} style={{ width: 60, height: 84, objectFit: 'cover', borderRadius: 4 }} />
                                     <div style={{ flex: 1 }}>
                                        <div style={{ fontWeight: 'bold', fontSize: 14 }}>{c.name}</div>
                                        <div style={{ fontSize: 12, color: colors.text }}>{c.rarity}</div>
                                        <div style={{ display: 'flex', gap: 6, marginTop: 8 }}>
                                           {c.normal > 0 && (
                                              <button onClick={() => setSellConfirm({ id: c.id, name: c.name, variant: 'normal', price: c.val*0.6 })} style={{ flex: 1, padding: 6, background: '#374151', border: 'none', color: 'white', borderRadius: 4, cursor: 'pointer', fontSize: 11 }}>
                                                 Sell Normal ({c.normal})<br/>{(c.val*0.6).toFixed(1)} R
                                              </button>
                                           )}
                                           {c.holo > 0 && (
                                              <button onClick={() => setSellConfirm({ id: c.id, name: c.name, variant: 'holo', price: c.val*holoMultipliers[c.id]*0.6 })} className="holo-button" style={{ flex: 1, padding: 6, borderRadius: 4, cursor: 'pointer', fontSize: 11, color: 'white' }}>
                                                 Sell Holo ({c.holo})<br/>{(c.val*holoMultipliers[c.id]*0.6).toFixed(1)} R
                                              </button>
                                           )}
                                        </div>
                                     </div>
                                  </div>
                               )
                            })}
                         </div>
                      </div>
                   )}
                </div>
             )}

             {/* --- COLLECTION VIEW --- */}
             {view === 'collection' && (
                <div>
                   <h2 style={{ textAlign: 'center' }}>Collection</h2>
                   <div style={{ display: 'flex', gap: 10, marginBottom: 15, flexWrap: 'wrap' }}>
                      <input value={collectionSearch} onChange={e => setCollectionSearch(e.target.value)} placeholder="Search..." style={{ padding: 10, borderRadius: 8, border: 'none', background: '#374151', color: 'white', flex: 1 }} />
                      <select value={ownedFilter} onChange={e => setOwnedFilter(e.target.value)} style={{ padding: 10, borderRadius: 8, border: 'none', background: '#374151', color: 'white' }}>
                         <option value="all">All</option>
                         <option value="owned">Owned</option>
                         <option value="unowned">Unowned</option>
                      </select>
                   </div>
                   
                   <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(100px, 1fr))', gap: 10 }}>
                      {getCollectionCards().map(c => {
                         const colors = RARITY_COLORS[c.rarity];
                         return (
                            <div key={c.id} onClick={() => { if(c.owned>0) setEnlargedCard(c) }} style={{ opacity: c.owned>0 ? 1 : 0.3, aspectRatio: '2.5/3.5', borderRadius: 8, border: `2px solid ${colors.border}`, overflow: 'hidden', position: 'relative', cursor: c.owned>0?'pointer':'default' }}>
                               {c.owned>0 ? <img src={getImageUrl(c)} style={{ width: '100%', height: '100%', objectFit: 'cover' }} /> : <div style={{ width: '100%', height: '100%', background: '#111827' }} />}
                               {c.owned>0 && <div style={{ position: 'absolute', bottom: 0, right: 0, background: 'rgba(0,0,0,0.7)', color: 'white', fontSize: 10, padding: '2px 4px' }}>x{c.owned}</div>}
                            </div>
                         )
                      })}
                   </div>
                </div>
             )}

             {/* --- SETTINGS VIEW --- */}
             {view === 'settings' && (
                <div>
                   <h2>Settings</h2>
                   <div style={{ background: '#1f2937', padding: 20, borderRadius: 12, marginBottom: 20 }}>
                      <h3>Save Data</h3>
                      <button onClick={() => { localStorage.clear(); window.location.reload(); }} style={{ padding: '10px 20px', background: '#ef4444', color: 'white', border: 'none', borderRadius: 8, cursor: 'pointer', marginRight: 10 }}>Reset All Data</button>
                      <button onClick={() => {
                         const data = { col: collection, inv: packInventory, rat: rations, day: gameDay };
                         setExportText(JSON.stringify(data));
                      }} style={{ padding: '10px 20px', background: '#3b82f6', color: 'white', border: 'none', borderRadius: 8, cursor: 'pointer' }}>Export Save</button>
                   </div>
                   {exportText && <textarea readOnly value={exportText} style={{ width: '100%', height: 100, background: '#111827', color: '#9ca3af', border: 'none', padding: 10, borderRadius: 8 }} />}
                </div>
             )}

           </main>
           
           {/* --- MODALS --- */}
           {enlargedCard && (
              <div className="modal-overlay" onClick={() => setEnlargedCard(null)}>
                 <div style={{ textAlign: 'center' }} onClick={e => e.stopPropagation()}>
                    <img src={getImageUrl(enlargedCard)} style={{ maxHeight: '70vh', maxWidth: '90vw', borderRadius: 16, border: `4px solid ${RARITY_COLORS[enlargedCard.rarity].border}`, boxShadow: `0 0 30px ${RARITY_COLORS[enlargedCard.rarity].border}` }} />
                    <div style={{ marginTop: 20 }}>
                       <h2 style={{ margin: 0 }}>{enlargedCard.name}</h2>
                       <p style={{ color: RARITY_COLORS[enlargedCard.rarity].text, textTransform: 'capitalize' }}>{enlargedCard.rarity}</p>
                       <p>Value: {marketValues[enlargedCard.id]?.toFixed(2)} R</p>
                    </div>
                 </div>
              </div>
           )}

           {purchaseConfirm && (
              <div className="modal-overlay" onClick={() => setPurchaseConfirm(null)}>
                 <div className="modal" onClick={e => e.stopPropagation()}>
                    <h3>Confirm Purchase</h3>
                    <p>Buy <b>{purchaseConfirm.title}</b> for <b>{purchaseConfirm.cost.toFixed(0)} R</b>?</p>
                    <div style={{ display: 'flex', gap: 10, marginTop: 20 }}>
                       <button onClick={() => buyItem(purchaseConfirm.type, purchaseConfirm.cost)} style={{ flex: 1, padding: 10, background: '#10b981', color: 'white', border: 'none', borderRadius: 6, cursor: 'pointer' }}>Confirm</button>
                       <button onClick={() => setPurchaseConfirm(null)} style={{ flex: 1, padding: 10, background: '#374151', color: 'white', border: 'none', borderRadius: 6, cursor: 'pointer' }}>Cancel</button>
                    </div>
                 </div>
              </div>
           )}
           
           {sellConfirm && (
              <div className="modal-overlay" onClick={() => setSellConfirm(null)}>
                 <div className="modal" onClick={e => e.stopPropagation()}>
                    <h3>Confirm Sale</h3>
                    <p>Sell <b>{sellConfirm.name}</b> ({sellConfirm.variant}) for <b>{sellConfirm.price.toFixed(1)} R</b>?</p>
                    <div style={{ display: 'flex', gap: 10, marginTop: 20 }}>
                       <button onClick={() => sellCard(sellConfirm.id, sellConfirm.variant)} style={{ flex: 1, padding: 10, background: '#10b981', color: 'white', border: 'none', borderRadius: 6, cursor: 'pointer' }}>Confirm</button>
                       <button onClick={() => setSellConfirm(null)} style={{ flex: 1, padding: 10, background: '#374151', color: 'white', border: 'none', borderRadius: 6, cursor: 'pointer' }}>Cancel</button>
                    </div>
                 </div>
              </div>
           )}

        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<TCGPackOpener />);
  </script>
</body>
</html>
